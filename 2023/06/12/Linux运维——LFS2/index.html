

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="liaoyue">
  <meta name="keywords" content="">
  
    <meta name="description" content="LFS（二）0.前言&amp;emsp;&amp;emsp;前文接下来基础的环境基础准备，我们接下来就需要进行进一步的搭建，比如对前篇文章工具的利用 &amp;emsp; 1.测试工具链 工具链概念  &amp;emsp;&amp;emsp;在Linux中，工具链是一种用于编译、链接和构建软件的工具集合，结合了编译器、汇编器、链接器和调试器等工具，将源代码转化为可执行的库文件，前面的四个库的安装和部署仅仅是为了给后续形成工具链而做足准备">
<meta property="og:type" content="article">
<meta property="og:title" content="LFS（二）">
<meta property="og:url" content="https://one-null-pointer.github.io/2023/06/12/Linux%E8%BF%90%E7%BB%B4%E2%80%94%E2%80%94LFS2/index.html">
<meta property="og:site_name" content="one-null-poniter">
<meta property="og:description" content="LFS（二）0.前言&amp;emsp;&amp;emsp;前文接下来基础的环境基础准备，我们接下来就需要进行进一步的搭建，比如对前篇文章工具的利用 &amp;emsp; 1.测试工具链 工具链概念  &amp;emsp;&amp;emsp;在Linux中，工具链是一种用于编译、链接和构建软件的工具集合，结合了编译器、汇编器、链接器和调试器等工具，将源代码转化为可执行的库文件，前面的四个库的安装和部署仅仅是为了给后续形成工具链而做足准备">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://one-null-pointer.github.io/img/Linux.png">
<meta property="article:published_time" content="2023-06-12T03:29:07.000Z">
<meta property="article:modified_time" content="2023-08-13T07:46:42.507Z">
<meta property="article:author" content="liaoyue">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://one-null-pointer.github.io/img/Linux.png">
  
  
  
  <title>LFS（二） - one-null-poniter</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"one-null-pointer.github.io","root":"/","version":"1.9.2","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 5.4.2"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>one null pointer</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                吾
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                學
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                類
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                友
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="LFS（二）"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-06-12 11:29" pubdate>
          June 12, 2023 am
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          16k words
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          131 mins
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">LFS（二）</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="LFS（二）"><a href="#LFS（二）" class="headerlink" title="LFS（二）"></a>LFS（二）</h1><h4 id="0-前言"><a href="#0-前言" class="headerlink" title="0.前言"></a>0.前言</h4><p>&emsp;&emsp;前文接下来基础的环境基础准备，我们接下来就需要进行进一步的搭建，比如对前篇文章工具的利用</p>
<p>&emsp;</p>
<h4 id="1-测试工具链"><a href="#1-测试工具链" class="headerlink" title="1.测试工具链"></a>1.测试工具链</h4><ul>
<li><h5 id="工具链概念"><a href="#工具链概念" class="headerlink" title="工具链概念"></a>工具链概念</h5></li>
</ul>
<p>&emsp;&emsp;在Linux中，工具链是一种用于编译、链接和构建软件的工具集合，结合了编译器、汇编器、链接器和调试器等工具，将源代码转化为可执行的库文件，前面的四个库的安装和部署仅仅是为了给后续形成工具链而做足准备条件</p>
<ul>
<li><h5 id="工具链调整"><a href="#工具链调整" class="headerlink" title="工具链调整"></a>工具链调整</h5></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mv</span> -v /tools/bin/&#123;ld,ld-old&#125;<br><span class="hljs-built_in">mv</span> -v /tools/$(gcc -dumpmachine)/bin/&#123;ld,ld-old&#125;<br><span class="hljs-built_in">mv</span> -v /tools/bin/&#123;ld-new,ld&#125;<br><span class="hljs-built_in">ln</span> -sv /tools/bin/ld /tools/$(gcc -dumpmachine)/bin/ld<br>gcc -dumpspecs | sed <span class="hljs-string">&#x27;s@^/lib/ld-linux.so.2@/tools&amp;@g&#x27;</span> &gt; `<span class="hljs-built_in">dirname</span> $(gcc -print-libgcc-file-name)`/specs<br>GCC_INCLUDEDIR=`<span class="hljs-built_in">dirname</span> $(gcc -print-libgcc-file-name)`/include<br>find <span class="hljs-variable">$&#123;GCC_INCLUDEDIR&#125;</span>/* -maxdepth 0 -xtype d -<span class="hljs-built_in">exec</span> <span class="hljs-built_in">rm</span> -rvf <span class="hljs-string">&#x27;&#123;&#125;&#x27;</span> \;<br><span class="hljs-built_in">rm</span> -vf `grep -l <span class="hljs-string">&quot;DO NOT EDIT THIS FILE&quot;</span> <span class="hljs-variable">$&#123;GCC_INCLUDEDIR&#125;</span>/*`<br><span class="hljs-built_in">unset</span> GCC_INCLUDEDIR<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——LFS（二）/1.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<ul>
<li><h5 id="测试工具链调整"><a href="#测试工具链调整" class="headerlink" title="测试工具链调整"></a>测试工具链调整</h5></li>
</ul>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;main()&#123;&#125;&#x27;</span> &gt; dummy.<span class="hljs-keyword">c</span><br><span class="hljs-keyword">cc</span> dummy.<span class="hljs-keyword">c</span><br>readelf -<span class="hljs-keyword">l</span> <span class="hljs-keyword">a</span>.out | <span class="hljs-keyword">grep</span> <span class="hljs-string">&#x27;tools&#x27;</span><br></code></pre></td></tr></table></figure>

<p>&emsp;&emsp;正常来说，如果输出大致如下 [Requesting program interpreter: /tools/lib/ld-linux.so.2]则表示调整成功，我这里输出结果发现是空的，很离谱，首先思考是不是我的路径存在问题，首先查看linux.so.2是否存在</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle">ls <span class="hljs-regexp">/mnt/</span>lfs<span class="hljs-regexp">/tools/</span>lib/ | <span class="hljs-keyword">grep</span> linux<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——LFS（二）/2.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;发现名字不一样，太可恶了，修改一下对应名称</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">mv <span class="hljs-regexp">/mnt/</span>lfs<span class="hljs-regexp">/tools/</span>lib<span class="hljs-regexp">/ld-linux-x86-64.so.2 /m</span>nt<span class="hljs-regexp">/lfs/</span>tools<span class="hljs-regexp">/lib/</span>ld-linux.so.<span class="hljs-number">2</span><br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——LFS（二）/3.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;为了防止再次出错，我们现在开始回头重新工具链接调整并且逐步验证，首先将/tools/bin目录下的ld文件重命名为ld-old</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs gradle">ls <span class="hljs-regexp">/tools/</span>bin/ | <span class="hljs-keyword">grep</span> ld<br>mv -v <span class="hljs-regexp">/tools/</span>bin/&#123;ld,ld-old&#125;<br>ls <span class="hljs-regexp">/tools/</span>bin/ | <span class="hljs-keyword">grep</span> ld<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——LFS（二）/4.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;将/tools/$(gcc -dumpmachine)/bin目录下的ld文件重命名为ld-old，其中$(gcc -dumpmachine)是GCC交叉编译器的目标体系结构, 一般返回值为x86_64-pc-linux-gnu</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs gradle">ls <span class="hljs-regexp">/tools/</span>$(gcc -dumpmachine)<span class="hljs-regexp">/bin/</span> | <span class="hljs-keyword">grep</span> ld<br>mv -v <span class="hljs-regexp">/tools/</span>$(gcc -dumpmachine)<span class="hljs-regexp">/bin/</span>&#123;ld,ld-old&#125;<br>ls <span class="hljs-regexp">/tools/</span>$(gcc -dumpmachine)<span class="hljs-regexp">/bin/</span> | <span class="hljs-keyword">grep</span> ld<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——LFS（二）/5.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;将/tools/bin目录下的ld-new文件重命名为ld</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs gradle">ls <span class="hljs-regexp">/tools/</span>bin/ | <span class="hljs-keyword">grep</span> ld<br>mv -v <span class="hljs-regexp">/tools/</span>bin/&#123;ld-<span class="hljs-keyword">new</span>,ld&#125;<br>ls <span class="hljs-regexp">/tools/</span>bin/ | <span class="hljs-keyword">grep</span> ld<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——LFS（二）/6.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;在/tools/$(gcc -dumpmachine)/bin目录下创建一个指向/tools/bin/ld的符号链接</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">ln -sv <span class="hljs-regexp">/tools/</span>bin<span class="hljs-regexp">/ld /</span>tools<span class="hljs-regexp">/$(gcc -dumpmachine)/</span>bin/ld<br>ls -l <span class="hljs-regexp">/tools/</span>$(gcc -dumpmachine)<span class="hljs-regexp">/bin/</span>ld<br></code></pre></td></tr></table></figure>

<p>&emsp;&emsp;该命令将显示/tools/$(gcc -dumpmachine)/bin目录下的ld文件的详细信息，包括其权限、所有者和大小等。如果输出中包含指向/tools/bin/ld的符号链接，则说明ln命令已成功创建</p>
<center><img src="/img/Linux运维——LFS（二）/7.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;从GCC交叉编译器中获取规范文件，并将其中的/lib/ld-linux.so.2路径替换为/tools/lib/ld-linux.so.2。前面也有so文件重新命名了</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">gcc -dumpspecs <span class="hljs-pattern-match">| sed &#x27;s@^<span class="hljs-operator">/</span>lib<span class="hljs-operator">/</span>ld-linux.so.2@<span class="hljs-operator">/</span>tools&amp;@g&#x27; &gt; dirname <span class="hljs-constructor">$(<span class="hljs-params">gcc</span> -<span class="hljs-params">print</span>-<span class="hljs-params">libgcc</span>-<span class="hljs-params">file</span>-<span class="hljs-params">name</span>)</span><span class="hljs-operator">/</span>specs</span><br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——LFS（二）/8.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;要检验命令是否成功，可以使用以下命令：</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle">cat `dirname $(gcc -<span class="hljs-keyword">print</span>-libgcc-<span class="hljs-keyword">file</span>-name)`<span class="hljs-regexp">/specs | grep /</span>tools<span class="hljs-regexp">/lib/</span>ld-linux.so.<span class="hljs-number">2</span><br></code></pre></td></tr></table></figure>

<p>&emsp;&emsp;该命令将显示$(gcc -print-libgcc-file-name)/specs文件中包含/tools/lib/ld-linux.so.2路径的行。如果输出中包含该路径，则说明sed命令已成功替换规范文件中的路径。发现没哟反馈，查了一下，发现是没有specs文件，直接歇逼，这里touch一下再重新执行gcc命令</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">touch `dirname <span class="hljs-constructor">$(<span class="hljs-params">gcc</span> -<span class="hljs-params">print</span>-<span class="hljs-params">libgcc</span>-<span class="hljs-params">file</span>-<span class="hljs-params">name</span>)</span>`/specs<br>ls -l <span class="hljs-constructor">$(<span class="hljs-params">gcc</span> -<span class="hljs-params">print</span>-<span class="hljs-params">libgcc</span>-<span class="hljs-params">file</span>-<span class="hljs-params">name</span>)</span><br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——LFS（二）/9.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;命令提示gcc：unrecognized option ‘-mtune=k8’，则可能是因为-mtune=k8选项不再被支持。-mtune=k8选项用于指定GCC编译器生成的代码针对AMD K8系列处理器进行优化。然而，该处理器已经过时，现代处理器通常使用更先进的架构和指令集。可以尝试将-mtune=k8选项替换为更适合当前处理器的选项，例如-march=native或者-march=x86-64。这些选项将根据当前系统的处理器类型自动选择最佳的优化设置</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">gcc -dumpspecs <span class="hljs-pattern-match">| sed &#x27;s@^<span class="hljs-operator">/</span>lib<span class="hljs-operator">/</span>ld-linux.so.2@<span class="hljs-operator">/</span>tools&amp;@g&#x27; | sed &#x27;s<span class="hljs-operator">/</span>-mtune=k8<span class="hljs-operator">/</span>-march=native<span class="hljs-operator">/</span>g&#x27; &gt; `dirname <span class="hljs-constructor">$(<span class="hljs-params">gcc</span> -<span class="hljs-params">print</span>-<span class="hljs-params">libgcc</span>-<span class="hljs-params">file</span>-<span class="hljs-params">name</span>)</span>`<span class="hljs-operator">/</span>specs</span><br></code></pre></td></tr></table></figure>

<p>&emsp;&emsp;我觉得可能是我之前的版本安装不兼容的问题，gcc的这个报错有些解决不了，后面发现这里使用的是_64的lfslivecd，猜测这里是对应的包在编译安装时出现了指引问题，我接下里的想法是先将lfslivecd的版本退回，基本是能搞定的。</p>
<p>&emsp;&emsp;工具链的调整方法有好几种，而且不同版本GCC的specs可能会有不同，但实际上都是把specs文件中的/lib/ld-linux.so.2替换成了/tools/lib/ld-linux.so.2即可，所以这里出现问题倒也正常。</p>
<p>&emsp;</p>
<h4 id="2-测试工具链调整（重整版）"><a href="#2-测试工具链调整（重整版）" class="headerlink" title="2.测试工具链调整（重整版）"></a>2.测试工具链调整（重整版）</h4><p>&emsp;&emsp;对于前面的报错进行了检测和尝试，猜测API Header的编译安装版本问题，推荐使用Linux-2.6.22.5，但是64位的虚拟lfsfilecd只有Linux-2.6.22.1的版本，反倒不适用了，后续就出现了一系列的报错问题，接下来我将64位的虚拟机改为32位进行实验操作，前面的操作基本一样，除了磁盘命名的差异，在32位中磁盘命名为hdd，64位中的磁盘命名为had，修改对应名称的指令即可，以及在gcc的编译安装中不需要添加–disable-multilib的指令，我延续前篇日报的测试工具链调整</p>
<p>&emsp;&emsp;如前篇文章中提到，要检验命令是否成功，可以使用以下命令</p>
<center><img src="/img/Linux运维——LFS（二）/10.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;该命令将显示$(gcc -print-libgcc-file-name)/specs文件中包含/tools/lib/ld-linux.so.2路径的行。如果输出中包含该路径，则说明sed命令已成功替换规范文件中的路径。这里终于也是输出了包含的该路径，说明命令操作成功</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">find <span class="hljs-variable">$&#123;GCC_INCLUDEDIR&#125;</span>/* -maxdepth 0 -xtype d -<span class="hljs-built_in">exec</span> <span class="hljs-built_in">rm</span> -rvf <span class="hljs-string">&#x27;&#123;&#125;&#x27;</span> \;<br><span class="hljs-built_in">rm</span> -vf `grep -l <span class="hljs-string">&quot;DO NOT EDIT THIS FILE&quot;</span> <span class="hljs-variable">$&#123;GCC_INCLUDEDIR&#125;</span>/*`<br><span class="hljs-built_in">unset</span> GCC_INCLUDEDIR<br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$GCC_INCLUDEDIR</span><br></code></pre></td></tr></table></figure>

<p>&emsp;&emsp;可以通过执行echo $GCC_INCLUDEDIR命令来检查GCC_INCLUDEDIR环境变量是否已经被成功取消设置。如果该命令返回空值，那么说明unset GCC_INCLUDEDIR命令已经成功运行并删除了GCC_INCLUDEDIR环境变</p>
<center><img src="/img/Linux运维——LFS（二）/11.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;好咧，再次进行工具链的调整和尝试：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;main()&#123;&#125;&#x27;</span> &gt; dummy.<span class="hljs-keyword">c</span><br><span class="hljs-keyword">cc</span> dummy.<span class="hljs-keyword">c</span><br>readelf -<span class="hljs-keyword">l</span> <span class="hljs-keyword">a</span>.out | <span class="hljs-keyword">grep</span> <span class="hljs-string">&#x27;tools&#x27;</span><br></code></pre></td></tr></table></figure>

<p>&emsp;&emsp;如果输出大致如下 [Requesting program interpreter: /tools/lib/ld-linux.so.2]，则表示调整成功，因为所有的库已经连接到了/tools/lib下</p>
<center><img src="/img/Linux运维——LFS（二）/12.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;测试成功后，由于内容空间有限，这里需要进行删除测试文件</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stata"><span class="hljs-keyword">rm</span> -rf a.<span class="hljs-keyword">out</span> dummy.c<br></code></pre></td></tr></table></figure>

<p>&emsp;&emsp;构建交叉编译工具链的作用是为目标系统（即LFS系统）提供一个能够在主机系统上运行的编译器和相关工具，以便在主机系统上编译和构建LFS系统所需的软件包。由于主机系统和目标系统的硬件架构和操作系统不同，因此需要使用交叉编译工具链来进行编译和构建。交叉编译工具链通常包括binutils、GCC和Glibc等工具，它们可以将源代码编译成适用于目标系统的可执行文件和库文件，为后续的LFS系统构建奠定基础。</p>
<p>&emsp;</p>
<h4 id="3-测试工具的安装"><a href="#3-测试工具的安装" class="headerlink" title="3.测试工具的安装"></a>3.测试工具的安装</h4><p>&emsp;&emsp;前面的测试仅仅是为了验证所有的库已经连接到了/tools/lib下，接下来就对于Binutils 和 GCC 等软件包套件的运行测试，为了支持本次测试，需要先安装Tcl、Expect 与 DejaGNU。只有运行了测试，才能确保重要工具的正常工作，因此这部分的测试尤为重要</p>
<ul>
<li><h5 id="Tcl-8-4-15的编译安装"><a href="#Tcl-8-4-15的编译安装" class="headerlink" title="Tcl-8.4.15的编译安装"></a>Tcl-8.4.15的编译安装</h5></li>
</ul>
<p>&emsp;&emsp;Tcl是一种脚本语言，用于编写各种应用程序和工具，在linux系统中通常是被用作解释器语言，一达到编写shell脚本，自动化测试脚本，GUI界面等</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">tar xvf /lfs-sources/tcl8.4.15-src.tar.gz<br><span class="hljs-built_in">cd</span> tcl8.4.15/unix<br>./configure --prefix=/tools<br>make<br>make install<br>make install-private-headers<br><span class="hljs-built_in">ln</span> -sv tclsh8.4 /tools/bin/tclsh<br></code></pre></td></tr></table></figure>

<p>&emsp;&emsp;这里的指令基本是认识的，除了make install-private-headers，该命令是Linux内核源码中的一个Makefile目标，它的作用是将内核的私有头文件安装到指定的目录中，这里是安装 Tcl 的头文件。下一个软件包 Expect 需要它们才能构建</p>
<center><img src="/img/Linux运维——LFS（二）/13.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<ul>
<li><h5 id="Expect-5-43-0的编译安装"><a href="#Expect-5-43-0的编译安装" class="headerlink" title="Expect-5.43.0的编译安装"></a>Expect-5.43.0的编译安装</h5></li>
</ul>
<p>&emsp;&emsp;上文提到Tcl 软件包包含工具命令语言，是一个可靠的通用脚本语言。Except 软件包是用 Tcl 语言编写的，因此需要先安装Tcl，接下来我们了解一下Expect，它是一种自动化工具，用于编写脚本来模拟用户与系统之间的交互，在Linux系统中，其通常是被用于自动化测试、远程登录、批量操作等场景</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-keyword">cd</span> $LFS/sources<br>tar xvf <span class="hljs-string">/lfs-sources/expect-5.43.0.tar.gz</span><br><span class="hljs-keyword">cd</span> expect-5.43<br><span class="hljs-keyword">patch</span> -Np1 -i <span class="hljs-string">/lfs-sources/expect-5.43.0-spawn-1.patch</span><br>cp configure&#123;,<span class="hljs-string">.bak</span>&#125;<br>sed &#x27;s@<span class="hljs-string">/usr/local/bin</span>@<span class="hljs-string">/bin</span>:@&#x27; configure.bak &gt; configure<br><span class="hljs-string">./configure</span> <span class="hljs-params">--prefix=/tools</span> <span class="hljs-params">--with-tcl=/tools/lib</span> <span class="hljs-params">--with-tclinclude=/tools/include</span> <span class="hljs-params">--with-x=no</span><br>make<br>make SCRIPTS=<span class="hljs-string">&quot;&quot;</span> install<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——LFS（二）/14.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;这里主要解析三个指令:</p>
<p>&emsp;&emsp;首先是patch –Np1 –i /lfs-sources/expect-5.43.0-spawn-1.patch，这个指令是应用了一个补丁文件到expect软件包的源代码中，也就是patch的作用，-N表示忽略已经存在的补丁，-p1选项表示去掉路径浅醉，-i则是指定要应用的不对文件，后续的/lfs-sources/expect-5.43.0-spawn-1.patch则是一个补丁文件的路径，包含了对expext软件包的修改内容</p>
<p>&emsp;&emsp;cp configure{,.bak}是将当前目录下的configure文件复制一份并将其备份为configure.bak文件，{,.bak}表示使用花括号扩展语法，将第一个参数（configure）扩展为两个参数（configure和.bak），从而实现同时复制和重命名的功能</p>
<p>&emsp;&emsp;sed ‘s@/usr/local/bin@/bin@’ configure.bak &gt; configure则是表示将configure.bak中的/usr/local/bin替换为了/bin覆盖掉现有的configure文件，开头的s便是替换的操作符</p>
<ul>
<li><h5 id="DejaGNU-1-4-4的编译安装"><a href="#DejaGNU-1-4-4的编译安装" class="headerlink" title="DejaGNU-1.4.4的编译安装"></a>DejaGNU-1.4.4的编译安装</h5></li>
</ul>
<p>&emsp;&emsp;DejaGNU也是一个自动化测试的框架，用于测试GNU工具集中的软件包，它可以在不同的操作系统和硬件平台上运行测试。其主要作用简化GNU软件包的测试过程，提高测试效率和准确性。其广泛应用于GNU工具集中的各种软件包的测试中，如GCC、GDB、Binutils等，这也就是我们为什么使用它的原因</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> <span class="hljs-variable">$LFS</span>/sources<br>tar xvf /lfs-sources/dejagnu-1.4.4.tar.gz<br><span class="hljs-built_in">cd</span> dejagnu-1.4.4<br>./configure --prefix=/tools<br>make install<br><br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——LFS（二）/15.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;安装成功后删除对应包的内容</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">cd</span> ..<br><span class="hljs-attribute">rm</span> -rf tcl8.<span class="hljs-number">4</span>.<span class="hljs-number">15</span><br><span class="hljs-attribute">rm</span> -rf expect-<span class="hljs-number">5</span>.<span class="hljs-number">43</span><br><span class="hljs-attribute">rm</span> -rf dejagnu-<span class="hljs-number">1</span>.<span class="hljs-number">4</span>.<span class="hljs-number">4</span><br></code></pre></td></tr></table></figure>

<ul>
<li><h5 id="GCC-4-1-2-Pass-2的编译安装"><a href="#GCC-4-1-2-Pass-2的编译安装" class="headerlink" title="GCC-4.1.2 - Pass 2的编译安装"></a>GCC-4.1.2 - Pass 2的编译安装</h5></li>
</ul>
<p>&emsp;&emsp;首先前面提到了GCC-4.1.2-Pass 1的编译安装，这里是Pass2的编译安装。 在lfs的搭建过程中，Pass1和Pass2是两个不同的阶段，GCC-4.1.2 - Pass 1是第一个编译阶段，它的目的是为了生成一个能够运行在当前主机上的最小化版本的GCC编译器。这个编译器只能用于后续的构建过程，而不能用于实际的应用程序开发。在这个阶段中，GCC会被编译成一个静态链接库，以便后续的构建过程可以使用它来编译其他软件包</p>
<p>&emsp;&emsp;GCC-4.1.2 - Pass 2是第二个编译阶段，它的目的是为了生成一个完整的、可用于实际应用程序开发的GCC编译器。在这个阶段中，GCC会被编译成一个动态链接库，并且会包含所有必要的库文件和头文件。这个编译器可以用于编译和链接实际的应用程序</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">tar xvf <span class="hljs-string">/lfs-sources/gcc-4.1.2.tar.bz2</span><br><span class="hljs-keyword">cd</span> gcc-4.1.2<br>cp -v gcc/Makefile.in&#123;,<span class="hljs-string">.orig</span>&#125;<br>sed &#x27;s@\<span class="hljs-string">./fixinc</span>\<span class="hljs-string">.sh</span>@-c <span class="hljs-literal">true</span>@&#x27; gcc/Makefile.in.orig &gt; gcc/Makefile.in<br>cp -v gcc/Makefile.in&#123;,<span class="hljs-string">.tmp</span>&#125;<br>sed &#x27;s/^XCFLAGS =$/&amp; -fomit-frame-pointer/&#x27; gcc/Makefile.in.tmp &gt; gcc/Makefile.in<br><span class="hljs-keyword">patch</span> -Np1 -i <span class="hljs-string">/lfs-sources/gcc-4.1.2-specs-1.patch</span><br>mkdir -v <span class="hljs-string">../gcc-build</span><br><span class="hljs-keyword">cd</span> <span class="hljs-string">../gcc-build</span><br><span class="hljs-string">../gcc-4.1.2/configure</span> <span class="hljs-params">--prefix=/tools</span> \<br><span class="hljs-params">--with-local-prefix=/tools</span> \<br><span class="hljs-params">--enable-clocale=gnu</span> <span class="hljs-params">--enable-shared</span> \<br><span class="hljs-params">--enable-threads=posix</span> <span class="hljs-params">--enable-__cxa_atexit</span> \<br><span class="hljs-params">--enable-languages=c</span>,c++ <span class="hljs-params">--disable-libstdcxx-pch</span><br>make<br>make install<br><span class="hljs-keyword">cd</span> <span class="hljs-string">..</span><br>rm -rf gcc-build<br>rm -rf gcc-4.1.2<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——LFS（二）/16.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;这里需要讲解一下的就是sed ‘s/^XCFLAGS =$/&amp; -fomit-frame-pointer/‘ gcc/Makefile.in.tmp &gt; gcc/Makefile.in，sed的使用，前文有了替换相关字符的案例讲解，这里是主要介绍’s/^XCFLAGS =$/&amp; -fomit-frame-pointer/‘，s表示替换操作，^XCFLAGS =$：表示查找以”XCFLAGS =”开头，以”$”结尾的行，&amp;表示匹配到的整个模式，-fomit-frame-pointer/则是要添加的选项</p>
<ul>
<li><h5 id="工具链再次调试"><a href="#工具链再次调试" class="headerlink" title="工具链再次调试"></a>工具链再次调试</h5></li>
</ul>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;main()&#123;&#125;&#x27;</span> &gt; dummy.<span class="hljs-keyword">c</span><br><span class="hljs-keyword">cc</span> dummy.<span class="hljs-keyword">c</span><br>readelf -<span class="hljs-keyword">l</span> <span class="hljs-keyword">a</span>.out | <span class="hljs-keyword">grep</span> <span class="hljs-string">&#x27;tools&#x27;</span><br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——LFS（二）/17.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;如果输出如下 [Requesting program interpreter: /tools/lib/ld-linux.so.2]</p>
<p>&emsp;&emsp;则表示调整成功，因为所有的库已经连接到了/tools/lib下。</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stata"><span class="hljs-keyword">rm</span> -rf a.<span class="hljs-keyword">out</span> dummy.c<br></code></pre></td></tr></table></figure>

<p>&emsp;</p>
<h4 id="4-其他基本软件包的编译和安装"><a href="#4-其他基本软件包的编译和安装" class="headerlink" title="4.其他基本软件包的编译和安装"></a>4.其他基本软件包的编译和安装</h4><p>&emsp;&emsp;继续编译和安装其他基本软件包，这些软件包提供了操作系统的其他重要功能，如文件压缩、文本处理、文件查找等。这些软件包将使我们的LFS系统更加完善和实用</p>
<ul>
<li><h5 id="Binutils-2-17-–-Pass-2"><a href="#Binutils-2-17-–-Pass-2" class="headerlink" title="Binutils-2.17 – Pass 2"></a>Binutils-2.17 – Pass 2</h5></li>
</ul>
<p>&emsp;&emsp;Binutils的功能和使用的效果前文也进行了说明，pass1和pass2的区别和作用也可以类比于前者gcc的相关安装，这里就不就行细节的阐述了</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">tar xvf /lfs-sources/binutils-2.17.tar.bz2<br><span class="hljs-built_in">mkdir</span> -v binutils-build<br><span class="hljs-built_in">cd</span> binutils-build<br>../binutils-2.17/configure --prefix=/tools --disable-nls --with-lib-path=/tools/lib<br>make<br>make install<br>make -C ld clean<br>make -C ld LIB_PATH=/usr/lib:/lib<br><span class="hljs-built_in">cp</span> -v ld/ld-new /tools/bin<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf binutils-build<br><span class="hljs-built_in">rm</span> -rf binutils-2.17<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——LFS（二）/18.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<ul>
<li><h5 id="Ncurses-5-6"><a href="#Ncurses-5-6" class="headerlink" title="Ncurses-5.6"></a>Ncurses-5.6</h5></li>
</ul>
<p>&emsp;&emsp;Ncurses是一个用于开发文本界面的库，它提供了一组API，可以在终端中创建复杂的用户界面。使用Ncurses库，开发者可以创建菜单、对话框、文本框等控件，并实现键盘和鼠标事件的处理。Ncurses库还支持多种颜色和字符属性，可以让界面更加美观和易于阅读。Ncurses库被广泛应用于Linux和Unix系统中的命令行工具和图形化界面程序的开发</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">tar xvf <span class="hljs-string">/lfs-sources/ncurses-5.6.tar.gz</span><br><span class="hljs-keyword">cd</span> ncurses-5.6<br><span class="hljs-string">./configure</span> <span class="hljs-params">--prefix=/tools</span> <span class="hljs-params">--with-shared</span> <span class="hljs-params">--without-debug</span> <span class="hljs-params">--without-ada</span> <span class="hljs-params">--enable-overwrite</span><br>make<br>make install<br><span class="hljs-keyword">cd</span> <span class="hljs-string">..</span><br>rm -rf ncurses-5.6<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——LFS（二）/19.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<ul>
<li><h5 id="Bash-3-2"><a href="#Bash-3-2" class="headerlink" title="Bash-3.2"></a>Bash-3.2</h5></li>
</ul>
<p>&emsp;&emsp;Bash是一种Unix/Linux操作系统下的命令行解释器，也是一种脚本语言。它可以执行用户输入的命令，并支持变量、条件语句、循环语句等基本编程结构，可以用于编写各种自动化脚本和任务。Bash还提供了丰富的内置命令和函数，可以方便地进行文件操作、进程管理、网络通信等操作。在Linux系统中，Bash通常作为默认的Shell</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">tar xvf <span class="hljs-string">/lfs-sources/bash-3.2.tar.gz</span><br><span class="hljs-keyword">cd</span> bash-3.2<br><span class="hljs-keyword">patch</span> -Np1 -i <span class="hljs-string">/lfs-sources/bash-3.2-fixes-5.patch</span><br><span class="hljs-string">./configure</span> <span class="hljs-params">--prefix=/tools</span> <span class="hljs-params">--without-bash-malloc</span><br>make<br>make install<br>ln -vs bash <span class="hljs-string">/tools/bin/sh</span><br><span class="hljs-keyword">cd</span> <span class="hljs-string">..</span><br>rm -rf bash-3.2<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——LFS（二）/20.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<ul>
<li><h5 id="Bzip2-1-0-4"><a href="#Bzip2-1-0-4" class="headerlink" title="Bzip2-1.0.4"></a>Bzip2-1.0.4</h5></li>
</ul>
<p>&emsp;&emsp;Bzip相比并不陌生，是一个用于压缩和解压缩文件的工具，它使用Burrows-Wheeler变换和霍夫曼编码算法来实现高效的数据压缩。是作为默认的压缩工具之一</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">tar</span> xvf /lfs-sources/bzip2-<span class="hljs-number">1</span>.<span class="hljs-number">0</span>.<span class="hljs-number">4</span>.tar.gz<br><span class="hljs-attribute">cd</span> bzip2-<span class="hljs-number">1</span>.<span class="hljs-number">0</span>.<span class="hljs-number">4</span><br><span class="hljs-attribute">make</span><br><span class="hljs-attribute">make</span> PREFIX=/tools install<br><span class="hljs-attribute">cd</span> ..<br><span class="hljs-attribute">rm</span> -rf bzip2-<span class="hljs-number">1</span>.<span class="hljs-number">0</span>.<span class="hljs-number">4</span><br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——LFS（二）/21.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<ul>
<li><h5 id="Coreutils-6-9"><a href="#Coreutils-6-9" class="headerlink" title="Coreutils-6.9"></a>Coreutils-6.9</h5></li>
</ul>
<p>&emsp;&emsp;Coreutils-6.9是一个包含了一系列基本命令行工具的软件包，它们是Linux和Unix系统中最常用的工具之一。这些工具包括cp、mv、rm、ls、mkdir、rmdir等，可以用于文件和目录的操作、文本处理、进程管理等任务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">tar xvf /lfs-sources/coreutils-6.9.tar.bz2<br><span class="hljs-built_in">cd</span> coreutils-6.9<br>./configure --prefix=/tools<br>make<br>make install<br><span class="hljs-built_in">cp</span> -v src/su /tools/bin/su-tools<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf coreutils-6.9<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——LFS（二）/22.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<ul>
<li><h5 id="Diffutils-2-8-1"><a href="#Diffutils-2-8-1" class="headerlink" title="Diffutils-2.8.1"></a>Diffutils-2.8.1</h5></li>
</ul>
<p>&emsp;&emsp;Diffutils是一个用于比较文件和目录之间差异的工具集合，它包括了diff、cmp、sdiff等命令。使用Diffutils-2.8.1，用户可以比较两个文本文件或目录之间的差异，并输出差异的详细信息。这些差异信息可以用于版本控制、代码审查、文件同步等任务。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">tar xvf /lfs-sources/diffutils-2.8.1.tar.gz<br><span class="hljs-built_in">cd</span> diffutils-2.8.1<br>./configure --prefix=/tools<br>make<br>make install<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf diffutils-2.8.1<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——LFS（二）/23.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<ul>
<li><h5 id="Findutils-4-2-31"><a href="#Findutils-4-2-31" class="headerlink" title="Findutils-4.2.31"></a>Findutils-4.2.31</h5></li>
</ul>
<p>&emsp;&emsp;Findutils是一个用于在文件系统中查找文件和目录的工具集合，它包括了find、locate、xargs等命令。通过Findutils，用户可以根据文件名、类型、大小、修改时间等条件来查找文件和目录，并输出它们的详细信息。这些信息可以用于文件管理、备份、恢复等任务。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">tar xvf /lfs-sources/findutils-4.2.31.tar.gz<br><span class="hljs-built_in">cd</span> findutils-4.2.31<br>./configure --prefix=/tools<br>make<br>make install<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf findutils-4.2.31<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——LFS（二）/24.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<ul>
<li><h5 id="Gawk-3-1-5"><a href="#Gawk-3-1-5" class="headerlink" title="Gawk-3.1.5"></a>Gawk-3.1.5</h5></li>
</ul>
<p>&emsp;&emsp;Gawk是一种文本处理工具，它是GNU Awk的缩写。Gawk可以读取文本文件，并对其中的数据进行处理和分析。它支持多种操作，如字符串匹配、正则表达式、数学计算、数组操作等</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">tar xvf /lfs-sources/gawk-3.1.5.tar.bz2<br><span class="hljs-built_in">cd</span> gawk-3.1.5<br>./configure --prefix=/tools<br><span class="hljs-built_in">cat</span> &gt;&gt; config.h &lt;&lt; <span class="hljs-string">&quot;EOF&quot;</span><br><span class="hljs-comment">#define HAVE_LANGINFO_CODESET 1</span><br><span class="hljs-comment">#define HAVE_LC_MESSAGES 1</span><br>EOF<br>make<br>make install<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf gawk-3.1.5<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——LFS（二）/25.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<ul>
<li><h5 id="Gettext-0-16-1"><a href="#Gettext-0-16-1" class="headerlink" title="Gettext-0.16.1"></a>Gettext-0.16.1</h5></li>
</ul>
<p>&emsp;&emsp;Gettext是一个用于国际化和本地化支持的工具集合，它包括了gettext、msgfmt、xgettext等命令。使用Gettext，开发者可以将程序中的文本字符串提取出来，并进行翻译和本地化处理，以适应不同的语言环境</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">tar xvf /lfs-sources/gettext-0.16.1.tar.gz<br><span class="hljs-built_in">cd</span> gettext-0.16.1<br><span class="hljs-built_in">cd</span> gettext-tools<br>./configure --prefix=/tools --disable-shared<br>make -C gnulib-lib<br>make -C src msgfmt<br><span class="hljs-built_in">cp</span> -v src/msgfmt /tools/bin<br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$LFS</span>/sources<br><span class="hljs-built_in">rm</span> -rf gettext-0.16.1<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——LFS（二）/26.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<ul>
<li><h5 id="Grep-2-5-1a"><a href="#Grep-2-5-1a" class="headerlink" title="Grep-2.5.1a"></a>Grep-2.5.1a</h5></li>
</ul>
<p>&emsp;&emsp;grep的作用就比较熟悉了，也是打交道较多的工具，用于文本搜索和过滤的命令行工具，它可以在文件中查找指定的字符串，并将包含该字符串的行输出到屏幕上。Grep支持多种搜索模式和选项，可以进行大小写敏感或不敏感的搜索，支持正则表达式等高级搜索功能。还嫩沟通过管道符号进行输入和输出的进一步传递</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs vim">tar xvf /lfs-sources/<span class="hljs-keyword">grep</span>-<span class="hljs-number">2.5</span>.<span class="hljs-number">1</span><span class="hljs-keyword">a</span>.tar.bz2<br><span class="hljs-keyword">cd</span> <span class="hljs-keyword">grep</span>-<span class="hljs-number">2.5</span>.<span class="hljs-number">1</span><span class="hljs-keyword">a</span><br>./configure --prefix=/tools --disable-<span class="hljs-keyword">perl</span>-regexp<br><span class="hljs-keyword">make</span><br><span class="hljs-keyword">make</span> install<br><span class="hljs-keyword">cd</span> ..<br>rm -rf <span class="hljs-keyword">grep</span>-<span class="hljs-number">2.5</span>.<span class="hljs-number">1</span><span class="hljs-keyword">a</span><br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——LFS（二）/27.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<ul>
<li><h5 id="Gzip-1-3-12"><a href="#Gzip-1-3-12" class="headerlink" title="Gzip-1.3.12"></a>Gzip-1.3.12</h5></li>
</ul>
<p>&emsp;&emsp;gzip是一个用于文件压缩和解压缩的命令行工具，它可以将文件压缩成gzip格式，并将压缩后的文件保存在磁盘上。gzip支持多种压缩级别和选项，可以根据需要进行不同程度的压缩和优化</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">tar xvf /lfs-sources/gzip-1.3.12.tar.gz<br><span class="hljs-built_in">cd</span> gzip-1.3.12<br>./configure --prefix=/tools<br>make<br>make install<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf gzip-1.3.12<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——LFS（二）/28.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<ul>
<li><h5 id="Make-3-81"><a href="#Make-3-81" class="headerlink" title="Make-3.81"></a>Make-3.81</h5></li>
</ul>
<p>&emsp;&emsp;make是一个用于编译源代码的命令行工具，它可以根据Makefile文件中的规则和依赖关系，自动化地进行编译、链接和生成目标文件等操作。Makefile文件通常包含了源代码的文件名、编译选项、依赖关系和目标文件等信息，用户可以通过修改Makefile文件来定制编译过程和生成不同的目标文件</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs vim">tar xvf /lfs-sources/<span class="hljs-keyword">make</span>-<span class="hljs-number">3.81</span>.tar.bz2<br><span class="hljs-keyword">cd</span> <span class="hljs-keyword">make</span>-<span class="hljs-number">3.81</span><br>./configure --prefix=/tools<br><span class="hljs-keyword">make</span><br><span class="hljs-keyword">make</span> install<br><span class="hljs-keyword">cd</span> ..<br>rm -rf <span class="hljs-keyword">make</span>-<span class="hljs-number">3.81</span><br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——LFS（二）/29.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<ul>
<li><h5 id="Patch-2-5-4"><a href="#Patch-2-5-4" class="headerlink" title="Patch-2.5.4"></a>Patch-2.5.4</h5></li>
</ul>
<p>&emsp;&emsp;Patch是一个用于文件补丁和更新的命令行工具，它可以将差异文件（patch文件）应用到原始文件中，以实现文件的更新、修复或修改等操作。Patch支持多种补丁格式和选项，可以根据需要进行不同类型的补丁操作。同时，Patch还可以与其他命令组合使用，例如通过管道符号将Patch的输出传递给另一个命令进行进一步处理</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">tar xvf /lfs-sources/patch-2.5.4.tar.gz<br><span class="hljs-built_in">cd</span> patch-2.5.4<br>./configure --prefix=/tools<br>make<br>make install<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf patch-2.5.4<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——LFS（二）/30.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<ul>
<li><h5 id="Perl-5-8-8"><a href="#Perl-5-8-8" class="headerlink" title="Perl-5.8.8"></a>Perl-5.8.8</h5></li>
</ul>
<p>&emsp;&emsp;Perl是一种通用的脚本语言，它具有强大的文本处理和正则表达式功能，可以用于各种任务，例如系统管理、网络编程、Web开发等。Perl-5.8.8版本在其发布时是一个非常流行的版本，许多软件和工具都使用了它作为基础环境</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs awk">tar xvf <span class="hljs-regexp">/lfs-sources/</span>perl-<span class="hljs-number">5.8</span>.<span class="hljs-number">8</span>.tar.bz2<br>cd perl-<span class="hljs-number">5.8</span>.<span class="hljs-number">8</span><br>patch -Np1 -i <span class="hljs-regexp">/lfs-sources/</span>perl-<span class="hljs-number">5.8</span>.<span class="hljs-number">8</span>-libc-<span class="hljs-number">2</span>.patch<br>.<span class="hljs-regexp">/configure.gnu --prefix=/</span>tools -Dstatic_ext=<span class="hljs-string">&#x27;Data/Dumper Fcntl IO POSIX&#x27;</span><br>make perl utilities<br>cp -v perl pod<span class="hljs-regexp">/pod2man /</span>tools/bin<br>mkdir -pv <span class="hljs-regexp">/tools/</span>lib<span class="hljs-regexp">/perl5/</span><span class="hljs-number">5.8</span>.<span class="hljs-number">8</span><br>cp -Rv lib<span class="hljs-regexp">/* /</span>tools<span class="hljs-regexp">/lib/</span>perl5/<span class="hljs-number">5.8</span>.<span class="hljs-number">8</span><br>cd ..<br>rm -rf perl-<span class="hljs-number">5.8</span>.<span class="hljs-number">8</span><br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——LFS（二）/31.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<ul>
<li><h5 id="Sed-4-1-5"><a href="#Sed-4-1-5" class="headerlink" title="Sed-4.1.5"></a>Sed-4.1.5</h5></li>
</ul>
<p>&emsp;&emsp;Sed是一个文本处理工具，它可以在命令行中对文本进行编辑和转换。它支持多种编辑模式和选项，可以根据需要进行不同类型的文本处理操作，例如替换、删除、插入、移动等</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">tar xvf /lfs-sources/sed-4.1.5.tar.gz<br><span class="hljs-built_in">cd</span> sed-4.1.5<br>./configure --prefix=/tools<br>make<br>make install<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf sed-4.1.5<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——LFS（二）/32.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<ul>
<li><h5 id="Tar-1-18"><a href="#Tar-1-18" class="headerlink" title="Tar-1.18"></a>Tar-1.18</h5></li>
</ul>
<p>&emsp;&emsp;tar是一个用于文件打包和解包的命令行工具，它可以将多个文件或目录打包成一个单独的文件，并将其保存在磁盘上。tar支持多种打包格式和选项，可以根据需要进行不同类型的打包和解包操作</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">tar xvf /lfs-sources/tar-1.18.tar.bz2<br><span class="hljs-built_in">cd</span> tar-1.18<br>./configure --prefix=/tools<br>make<br>make install<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf tar-1.18<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——LFS（二）/33.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<ul>
<li><h5 id="Texinfo-4-9"><a href="#Texinfo-4-9" class="headerlink" title="Texinfo-4.9"></a>Texinfo-4.9</h5></li>
</ul>
<p>&emsp;&emsp;Texinfo是一个用于文档编写和格式化的工具，它可以将纯文本文件转换成各种格式的文档，例如HTML、PDF、Info等。Texinfo支持多种标记语言和选项，可以根据需要进行不同类型的文档编写和格式化操作</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">tar xvf /lfs-sources/texinfo-4.9.tar.bz2<br><span class="hljs-built_in">cd</span> texinfo-4.9<br>./configure --prefix=/tools<br>make<br>make install<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf texinfo-4.9<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——LFS（二）/34.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<ul>
<li><h5 id="Util-linux-2-12r"><a href="#Util-linux-2-12r" class="headerlink" title="Util-linux-2.12r"></a>Util-linux-2.12r</h5></li>
</ul>
<p>&emsp;&emsp;util-linux 是一个开放源码的软件包，是一个对任何Linux系统的基本工具套件。 含有一些标准UNIX 工具，如login。 Util-linux 软件包包含许多工具。 其中比较重要的是加载、卸载、格式化、分区和管理硬盘驱动器，打开tty 端口和得到内核消息</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs powershell">tar xvf /lfs<span class="hljs-literal">-sources</span>/util<span class="hljs-literal">-linux-2</span>.<span class="hljs-number">12</span>r.tar.bz2<br><span class="hljs-built_in">cd</span> util<span class="hljs-literal">-linux-2</span>.<span class="hljs-number">12</span><span class="hljs-built_in">r</span><br>sed <span class="hljs-literal">-i</span> <span class="hljs-string">&#x27;s@/usr/include@/tools/include@g&#x27;</span> configure<br>./configure<br>make <span class="hljs-literal">-C</span> lib<br>make <span class="hljs-literal">-C</span> <span class="hljs-built_in">mount</span> <span class="hljs-built_in">mount</span> umount<br>make <span class="hljs-literal">-C</span> text<span class="hljs-literal">-utils</span> more<br><span class="hljs-built_in">cp</span> <span class="hljs-literal">-v</span> <span class="hljs-built_in">mount</span>/&#123;,u&#125;<span class="hljs-built_in">mount</span> text<span class="hljs-literal">-utils</span>/more /tools/bin<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> <span class="hljs-literal">-rf</span> util<span class="hljs-literal">-linux-2</span>.<span class="hljs-number">12</span><span class="hljs-built_in">r</span><br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——LFS（二）/35.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<ul>
<li><h5 id="Stripping"><a href="#Stripping" class="headerlink" title="Stripping"></a>Stripping</h5></li>
</ul>
<p>&emsp;&emsp;Stripping是指从可执行文件中删除不必要的符号信息和调试信息，以减小文件大小并保护代码的安全性。在编译生成可执行文件时，编译器会将一些符号信息和调试信息嵌入到文件中，这些信息对于调试和开发过程非常有用，但是在发布产品时却不需要这些信息。因此，通过使用strip命令可以去除这些信息，从而减小文件大小</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">strip --strip-debug <span class="hljs-regexp">/tools/</span>lib/*<br>strip --strip-unneeded <span class="hljs-regexp">/tools/</span>&#123;,s&#125;bin/*<br>rm -rf <span class="hljs-regexp">/tools/</span>&#123;info,man&#125;<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——LFS（二）/36.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;接下来退出lfs用户</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-keyword">exit</span><br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——LFS（二）/37.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;</p>
<h4 id="5-创建系统配置文件"><a href="#5-创建系统配置文件" class="headerlink" title="5.创建系统配置文件"></a>5.创建系统配置文件</h4><p>&emsp;&emsp;通过前面的步骤，我们就把基本的软件包都编译安装完毕了，接下来就是配置系统的配置文件了，首先是重新设置目录权限</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">chown</span> -R root:root <span class="hljs-variable">$LFS</span>/tools<br></code></pre></td></tr></table></figure>

<p>&emsp;&emsp;创建三个重要的目录，dev、proc和sys是Linux系统中的三个特殊目录，它们分别用于存储设备文件、进程信息和系统状态信息。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> -pv <span class="hljs-variable">$LFS</span>/&#123;dev,proc,sys&#125;<br></code></pre></td></tr></table></figure>

<p>&emsp;&emsp;再创建两个目标系统所必须的设备文件</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">mknod</span> -m <span class="hljs-number">600</span> $LFS/dev/console c <span class="hljs-number">5</span> <span class="hljs-number">1</span><br><span class="hljs-attribute">mknod</span> -m <span class="hljs-number">666</span> $LFS/dev/null c <span class="hljs-number">1</span> <span class="hljs-number">3</span><br></code></pre></td></tr></table></figure>

<p>&emsp;&emsp;mknod -m 600 $LFS/dev/console c 5 1创建了一个名为console的字符设备文件，它的主设备号为5，次设备号为1。该设备文件通常用于控制台输出，即显示系统启动信息和用户登录提示等，第二个命令mknod -m 666 $LFS/dev/null c 1 3创建了一个名为null的字符设备文件，它的主设备号为1，次设备号为3。该设备文件通常用于丢弃不需要的输出，即将输出重定向到null设备文件中，从而实现“黑洞”效果</p>
<p>&emsp;&emsp;这里需要学习一下，之前没有接触过黑洞效果的概念，黑洞效果是指将输出重定向到一个特殊的设备文件中，从而实现“丢弃”输出的效果，在Linux系统中，null设备文件就是用于首先黑洞效果的一种常见方式，当程序输出内容时，如果将其重定向到null设备文件中，那么这些输出就会被直接丢弃，不会显示在屏幕上，也不会写入到文件中</p>
<p>&emsp;&emsp;利用主系统加载几个重要的文件系统</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">mount -v --<span class="hljs-built_in">bind</span> /dev <span class="hljs-variable">$LFS</span>/dev<br>mount -vt devpts devpts <span class="hljs-variable">$LFS</span>/dev/pts<br>mount -vt tmpfs shm <span class="hljs-variable">$LFS</span>/dev/shm<br>mount -vt proc proc <span class="hljs-variable">$LFS</span>/proc<br>mount -vt sysfs sysfs <span class="hljs-variable">$LFS</span>/sys<br></code></pre></td></tr></table></figure>

<center><img src="/img/Linux运维——LFS（二）/38.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;这里需要注意的是，当我们使用mount命令挂载分区时，操作系统会将该分区的文件系统信息保存在内存中。但是，当重新启动系统时，这些信息就会丢失，因为它们只存在于内存中，而没有被写入到磁盘上。因此，在重新启动系统后，之前挂载的分区就会失效，需要重新使用mount命令加载。</p>
<p>&emsp;&emsp;再接下来就是将lfs-sources里面的源码包复制到$LFS/sources目录中</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">cp –a <span class="hljs-regexp">/lfs--sources/</span>* <span class="hljs-variable">$LFS</span><span class="hljs-regexp">/sources/</span><br></code></pre></td></tr></table></figure>

<p>&emsp;&emsp;Chroot到目标系统的目录</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ruby">chroot <span class="hljs-string">&quot;$LFS&quot;</span> /tools/bin/env -i \<br><span class="hljs-variable constant_">HOME</span>=<span class="hljs-regexp">/root TERM=&quot;$TERM&quot; PS1=&#x27;\u:\w\$ &#x27; \</span><br><span class="hljs-regexp">PATH=/bin</span><span class="hljs-symbol">:/usr/bin</span><span class="hljs-symbol">:/sbin</span><span class="hljs-symbol">:/usr/sbin</span><span class="hljs-symbol">:/tools/bin</span> \<br>/tools/bin/bash --login +h<br></code></pre></td></tr></table></figure>

<p>&emsp;&emsp;该命令将$LFS变量指定的目录作为新的根目录，并使用/tools/bin/env命令创建一个新的环境变量。然后，它设置了一些常见的环境变量，如HOME、TERM和PATH，并指定了一个新的提示符PS1。</p>
<p>&emsp;&emsp;最后，该命令使用/tools/bin/bash命令启动一个新的bash shell，并通过–login选项加载用户的配置文件。+h选项表示启用历史记录功能，即保存之前输入的命令，以便下次使用时可以调用</p>
<center><img src="/img/Linux运维——LFS（二）/39.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</center>

<p>&emsp;&emsp;这时候，我们会在提示符的位置，发现“I have no name!”，这是正常的，当系统无法读取/etc/passwd文件中的用户信息时，就会出现提示符为“I have no name!”的情况，我们并没有设置，所以就是这种情况</p>
<p>&emsp;&emsp;这篇的内容大致上就在这里结束了，接下来就是建立目标系统的目录结构等相关内容了。</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/Linux%E8%BF%90%E7%BB%B4/" class="category-chain-item">Linux运维</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>LFS（二）</div>
      <div>https://one-null-pointer.github.io/2023/06/12/Linux运维——LFS2/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>Author</div>
          <div>liaoyue</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Posted on</div>
          <div>June 12, 2023</div>
        </div>
      
      
      <div class="license-meta-item">
        <div>传送口</div>
        <div>
          
            
            
              <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
              <span class="hint--top hint--rounded" aria-label="点击进行传送">
                <i class="iconfont icon-by"></i>
              </span>
              </a>
            
          
        </div>
      </div>
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2023/06/13/Linux%E8%BF%90%E7%BB%B4%E2%80%94%E2%80%94LFS3/" title="LFS（三）">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">LFS（三）</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2023/06/11/Linux%E8%BF%90%E7%BB%B4%E2%80%94%E2%80%94LFS/" title="LFS（一）">
                        <span class="hidden-mobile">LFS（一）</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;Table of Contents</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">Keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://github.com/" target="_blank" rel="nofollow noopener"><span>pointer</span></a> <i class="iconfont icon-love"></i> <a href="https://mp.weixin.qq.com/s/6ncLUtaiJ9j_sMjZT5z-2w" target="_blank" rel="nofollow noopener"><span>一个爱学习的空指针</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      headingSelector : CONFIG.toc.headingSelector || 'h1,h2,h3,h4,h5,h6',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      collapseDepth   : CONFIG.toc.collapseDepth || 0,
      scrollSmooth    : true,
      headingsOffset  : -boardTop
    });
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">Blog works best with JavaScript enabled</div>
  </noscript>
</body>
</html>
